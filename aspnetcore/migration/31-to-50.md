---
title: ASP.NET Core 3.1 から5.0 への移行
author: scottaddie
description: ASP.NET Core 3.1 プロジェクトを ASP.NET Core 5.0 に移行する方法について説明します。
ms.author: scaddie
ms.custom: mvc
ms.date: 12/02/2020
no-loc:
- appsettings.json
- ASP.NET Core Identity
- cookie
- Cookie
- Blazor
- Blazor Server
- Blazor WebAssembly
- Identity
- Let's Encrypt
- Razor
- SignalR
uid: migration/31-to-50
ms.openlocfilehash: a4da8767bc483b2f5bd156dfecea64560a9c5e7e
ms.sourcegitcommit: 6299f08aed5b7f0496001d093aae617559d73240
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 12/14/2020
ms.locfileid: "97486188"
---
# <a name="migrate-from-aspnet-core-31-to-50"></a><span data-ttu-id="f6751-103">ASP.NET Core 3.1 から5.0 への移行</span><span class="sxs-lookup"><span data-stu-id="f6751-103">Migrate from ASP.NET Core 3.1 to 5.0</span></span>

<span data-ttu-id="f6751-104">作成者: [Scott Addie](https://github.com/scottaddie)</span><span class="sxs-lookup"><span data-stu-id="f6751-104">By [Scott Addie](https://github.com/scottaddie)</span></span>

<span data-ttu-id="f6751-105">この記事では、既存の ASP.NET Core 3.1 プロジェクトを ASP.NET Core 5.0 に更新する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="f6751-105">This article explains how to update an existing ASP.NET Core 3.1 project to ASP.NET Core 5.0.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="f6751-106">必須コンポーネント</span><span class="sxs-lookup"><span data-stu-id="f6751-106">Prerequisites</span></span>

# <a name="visual-studio"></a>[<span data-ttu-id="f6751-107">Visual Studio</span><span class="sxs-lookup"><span data-stu-id="f6751-107">Visual Studio</span></span>](#tab/visual-studio)

[!INCLUDE[](~/includes/net-core-prereqs-vs-5.0.md)]

# <a name="visual-studio-code"></a>[<span data-ttu-id="f6751-108">Visual Studio Code</span><span class="sxs-lookup"><span data-stu-id="f6751-108">Visual Studio Code</span></span>](#tab/visual-studio-code)

[!INCLUDE[](~/includes/net-core-prereqs-vsc-5.0.md)]

# <a name="visual-studio-for-mac"></a>[<span data-ttu-id="f6751-109">Visual Studio for Mac</span><span class="sxs-lookup"><span data-stu-id="f6751-109">Visual Studio for Mac</span></span>](#tab/visual-studio-mac)

[!INCLUDE[](~/includes/net-core-prereqs-mac-5.0.md)]

---

## <a name="update-net-core-sdk-version-in-globaljson"></a><span data-ttu-id="f6751-110">global.json での .NET Core SDK バージョンの更新</span><span class="sxs-lookup"><span data-stu-id="f6751-110">Update .NET Core SDK version in global.json</span></span>

<span data-ttu-id="f6751-111">ファイル [ のglobal.js](/dotnet/core/tools/global-json) に依存して特定の .NET Core SDK バージョンを対象とする場合は、 `version` インストールされている .net 5.0 SDK バージョンにプロパティを更新します。</span><span class="sxs-lookup"><span data-stu-id="f6751-111">If you rely upon a [global.json](/dotnet/core/tools/global-json) file to target a specific .NET Core SDK version, update the `version` property to the .NET 5.0 SDK version that's installed.</span></span> <span data-ttu-id="f6751-112">次に例を示します。</span><span class="sxs-lookup"><span data-stu-id="f6751-112">For example:</span></span>

```diff
{
  "sdk": {
-    "version": "3.1.200"
+    "version": "5.0.100"
  }
}
```

## <a name="update-the-target-framework"></a><span data-ttu-id="f6751-113">ターゲットフレームワークを更新する</span><span class="sxs-lookup"><span data-stu-id="f6751-113">Update the target framework</span></span>

<span data-ttu-id="f6751-114">プロジェクトを更新 Blazor WebAssembly する場合は、「 [ Blazor WebAssembly プロジェクトの更新](#update-blazor-webassembly-projects) 」セクションに進みます。</span><span class="sxs-lookup"><span data-stu-id="f6751-114">If updating a Blazor WebAssembly project, skip to the [Update Blazor WebAssembly projects](#update-blazor-webassembly-projects) section.</span></span> <span data-ttu-id="f6751-115">その他の ASP.NET Core プロジェクトの種類については、プロジェクトファイルの [ターゲットフレームワークモニカー (TFM)](/dotnet/standard/frameworks) を次のように更新し `net5.0` ます。</span><span class="sxs-lookup"><span data-stu-id="f6751-115">For any other ASP.NET Core project type, update the project file's [Target Framework Moniker (TFM)](/dotnet/standard/frameworks) to `net5.0`:</span></span>

```diff
<Project Sdk="Microsoft.NET.Sdk.Web">

  <PropertyGroup>
-    <TargetFramework>netcoreapp3.1</TargetFramework>
+    <TargetFramework>net5.0</TargetFramework>
  </PropertyGroup>

</Project>
```

## <a name="changes-to-no-locblazor-app-routing-logic-in-501"></a><span data-ttu-id="f6751-116">Blazor5.0.1 でのアプリルーティングロジックの変更</span><span class="sxs-lookup"><span data-stu-id="f6751-116">Changes to Blazor app routing logic in 5.0.1</span></span>

<span data-ttu-id="f6751-117">ルートの優先順位の計算は ASP.NET Core 5.0.1 パッチリリースで変更されました。</span><span class="sxs-lookup"><span data-stu-id="f6751-117">The computation of route precedence changed in the ASP.NET Core 5.0.1 patch release.</span></span> <span data-ttu-id="f6751-118">これは、省略可能なパラメーターを使用して、すべてのルートまたはルートを定義した場合に影響を与える可能性があります。</span><span class="sxs-lookup"><span data-stu-id="f6751-118">This might affect you if you've defined catch-all routes or routes with optional parameters.</span></span>

### <a name="old-behavior"></a><span data-ttu-id="f6751-119">以前の動作</span><span class="sxs-lookup"><span data-stu-id="f6751-119">Old behavior</span></span>

<span data-ttu-id="f6751-120">ASP.NET Core 5.0.0 以前の動作では、など、優先順位の低いルートがより `{*slug}` 優先順位の高いルート (など) と一致し `/customer/{id}` ます。</span><span class="sxs-lookup"><span data-stu-id="f6751-120">With the prior behavior in ASP.NET Core 5.0.0 or earlier, routes with lower precedence, such as `{*slug}`, are matched before routes with higher precedence, such as `/customer/{id}`.</span></span>

### <a name="new-behavior"></a><span data-ttu-id="f6751-121">新しい動作</span><span class="sxs-lookup"><span data-stu-id="f6751-121">New behavior</span></span>

<span data-ttu-id="f6751-122">ASP.NET Core 5.0.1 以降の新しい動作では ASP.NET Core アプリで定義されているルーティングの動作がより厳密に一致しています。ここでは、フレームワークが最初に各セグメントのルートの優先順位を計算して確立し、ルートの長さのみを使用して、2次基準として結合を解除します。</span><span class="sxs-lookup"><span data-stu-id="f6751-122">The new behavior in ASP.NET Core 5.0.1 or later more closely matches the routing behavior defined in ASP.NET Core apps, where the framework computes and establishes the route precedence for each segment first and only uses the length of the route to break ties as a secondary criteria.</span></span>

### <a name="reason-for-change"></a><span data-ttu-id="f6751-123">変更理由</span><span class="sxs-lookup"><span data-stu-id="f6751-123">Reason for change</span></span>

<span data-ttu-id="f6751-124">元の動作は、ルーティング Blazor によってサポートされる機能のサブセットに対してルーティングシステムが ASP.NET Core ルーティングシステムと同じように動作することが目的であるため、実装のバグと見なされ Blazor ます。</span><span class="sxs-lookup"><span data-stu-id="f6751-124">The original behavior is considered a bug in the implementation because our goal is for the Blazor routing system to behave in the same way as the ASP.NET Core routing system for the subset of features supported by Blazor routing.</span></span>

### <a name="recommended-action"></a><span data-ttu-id="f6751-125">推奨アクション</span><span class="sxs-lookup"><span data-stu-id="f6751-125">Recommended action</span></span>

<span data-ttu-id="f6751-126">ファイル内のコンポーネントに属性を追加して、 `PreferExactMatches` `Router` `App.razor` 正しい動作を選択します。</span><span class="sxs-lookup"><span data-stu-id="f6751-126">Add the `PreferExactMatches` attribute to the `Router` component in the `App.razor` file to opt into the correct behavior:</span></span>

```razor
<Router AppAssembly="@typeof(Program).Assembly" PreferExactMatches="true">
```

<span data-ttu-id="f6751-127">`PreferExactMatches`がに設定されている場合 `true` 、ルート一致では、ワイルドカードで完全一致が優先されます。</span><span class="sxs-lookup"><span data-stu-id="f6751-127">When `PreferExactMatches` is set to `true`, route matching prefers exact matches over wildcards.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="f6751-128">すべてのアプリは、明示的にに設定する必要があり `PreferExactMatches` `true` ます。</span><span class="sxs-lookup"><span data-stu-id="f6751-128">All apps should explicitly set `PreferExactMatches` to `true`.</span></span>
>
> <span data-ttu-id="f6751-129">オプションをに設定するか、設定を解除したままにすることができ `false` ます。このオプションは、既定では `false` 、 *旧バージョンとの互換性のためだけに用意* されています。</span><span class="sxs-lookup"><span data-stu-id="f6751-129">The ability to set the option to `false` or leave it unset, which defaults the option to `false`, *is only provided for backward compatibility*.</span></span>
>
> <span data-ttu-id="f6751-130">.NET 6 がリリースされると、ルーターは常に完全一致を優先し、 `PreferExactMatches` オプションは使用できなくなります。</span><span class="sxs-lookup"><span data-stu-id="f6751-130">When .NET 6 is released, the router will always prefer exact matches, and the `PreferExactMatches` option won't be available.</span></span>

## <a name="update-no-locblazor-webassembly-and-no-locblazor-server-projects"></a><span data-ttu-id="f6751-131">更新プログラム Blazor WebAssembly と Blazor Server プロジェクト</span><span class="sxs-lookup"><span data-stu-id="f6751-131">Update Blazor WebAssembly and Blazor Server projects</span></span>

<span data-ttu-id="f6751-132">*このセクションのガイダンスは、両方の Blazor ホストモデルに適用されます。このセクションの後のセクションでは、ホスティングモデルとアプリの種類に固有の追加のガイダンスを提供します。関連するすべてのセクションのガイダンスをアプリに適用します。*</span><span class="sxs-lookup"><span data-stu-id="f6751-132">*The guidance in this section applies to both Blazor hosting models. Sections following this section provide additional guidance specific to hosting models and app types. Apply the guidance from all relevant sections to your app.*</span></span>

1. <span data-ttu-id="f6751-133">アプリまたはアプリので、 `wwwroot/index.html` Blazor WebAssembly `Pages/_Host.cshtml` Blazor Server `<link>` スタイルの要素に要素を追加し `<head>` ます。</span><span class="sxs-lookup"><span data-stu-id="f6751-133">In `wwwroot/index.html` of a Blazor WebAssembly app or the `Pages/_Host.cshtml` of a Blazor Server app, add a `<link>` element to the `<head>` element for styles.</span></span> <span data-ttu-id="f6751-134">次の `<link>` 要素 `href` 属性値では、プレースホルダー `{ASSEMBLY NAME}` はアプリのアセンブリ名です。</span><span class="sxs-lookup"><span data-stu-id="f6751-134">In the following `<link>` element `href` attribute values, the placeholder `{ASSEMBLY NAME}` is the app's assembly name.</span></span>

    ```diff
    +<link href="{ASSEMBLY NAME}.styles.css" rel="stylesheet" />
    ```
    
    <span data-ttu-id="f6751-135">スタンドアロン Blazor WebAssembly または Blazor Server 例:</span><span class="sxs-lookup"><span data-stu-id="f6751-135">Standalone Blazor WebAssembly or Blazor Server example:</span></span>
    
    ```diff
    +<link href="BlazorSample.styles.css" rel="stylesheet" />
    ```

    <span data-ttu-id="f6751-136">*`Client`* ホストされているソリューションのプロジェクトの Blazor WebAssembly 例:</span><span class="sxs-lookup"><span data-stu-id="f6751-136">*`Client`* project of a hosted Blazor WebAssembly solution example:</span></span>
    
    ```diff
    +<link href="BlazorSample.Client.styles.css" rel="stylesheet" />
    ```

1. <span data-ttu-id="f6751-137">`_Imports.razor`[コンポーネントの仮想化](xref:blazor/components/virtualization)用に、アプリのファイルに新しい名前空間を含め <xref:Microsoft.AspNetCore.Components.Web.Virtualization?displayProperty=fullName> ます。</span><span class="sxs-lookup"><span data-stu-id="f6751-137">Include a new namespace in the app's `_Imports.razor` file for [component virtualization](xref:blazor/components/virtualization), <xref:Microsoft.AspNetCore.Components.Web.Virtualization?displayProperty=fullName>.</span></span> <span data-ttu-id="f6751-138">次の `_Imports.razor` ファイルは、プロジェクトテンプレートから生成されたアプリの既定の名前空間を示して Blazor います。</span><span class="sxs-lookup"><span data-stu-id="f6751-138">The following `_Imports.razor` files show the default namespaces in apps generated from the Blazor project templates.</span></span> <span data-ttu-id="f6751-139">プレースホルダー `{ASSEMBLY NAME}` は、アプリのアセンブリ名です。</span><span class="sxs-lookup"><span data-stu-id="f6751-139">The placeholder `{ASSEMBLY NAME}` is the app's assembly name.</span></span>

   <span data-ttu-id="f6751-140">Blazor WebAssembly (`_Imports.razor`):</span><span class="sxs-lookup"><span data-stu-id="f6751-140">Blazor WebAssembly (`_Imports.razor`):</span></span>
   
   ```razor
   @using System.Net.Http
   @using System.Net.Http.Json
   @using Microsoft.AspNetCore.Components.Forms
   @using Microsoft.AspNetCore.Components.Routing
   @using Microsoft.AspNetCore.Components.Web
   @using Microsoft.AspNetCore.Components.Web.Virtualization
   @using Microsoft.AspNetCore.Components.WebAssembly.Http
   @using Microsoft.JSInterop
   @using {ASSEMBLY NAME}
   @using {ASSEMBLY NAME}.Shared
   ```

   <span data-ttu-id="f6751-141">Blazor Server (`_Imports.razor`):</span><span class="sxs-lookup"><span data-stu-id="f6751-141">Blazor Server (`_Imports.razor`):</span></span>
   
   ```razor
   @using System.Net.Http
   @using Microsoft.AspNetCore.Authorization
   @using Microsoft.AspNetCore.Components.Authorization
   @using Microsoft.AspNetCore.Components.Forms
   @using Microsoft.AspNetCore.Components.Routing
   @using Microsoft.AspNetCore.Components.Web
   @using Microsoft.AspNetCore.Components.Web.Virtualization
   @using Microsoft.JSInterop
   @using {ASSEMBLY NAME}
   @using {ASSEMBLY NAME}.Shared
   ```
   
1. <span data-ttu-id="f6751-142">`MainLayout`コンポーネント () で `Shared/MainLayout.razor` 、コンポーネントの HTML マークアップを、 `<div>` 属性がに設定された要素で囲み `class` `page` ます。</span><span class="sxs-lookup"><span data-stu-id="f6751-142">In the `MainLayout` component (`Shared/MainLayout.razor`), surround the component's HTML markup with a `<div>` element that has a `class` attribute set to `page`:</span></span>

    ```razor
    <div class="page">
    
        ...
        
    </div>
    ```
    
1. <span data-ttu-id="f6751-143">次のファイルをフォルダーに追加し `Shared` ます。</span><span class="sxs-lookup"><span data-stu-id="f6751-143">Add the following files to the `Shared` folder:</span></span>

    <span data-ttu-id="f6751-144">`MainLayout.razor.css`:</span><span class="sxs-lookup"><span data-stu-id="f6751-144">`MainLayout.razor.css`:</span></span>
    
    ```css
    .page {
        position: relative;
        display: flex;
        flex-direction: column;
    }

    .main {
        flex: 1;
    }

    .sidebar {
        background-image: linear-gradient(180deg, rgb(5, 39, 103) 0%, #3a0647 70%);
    }

    .top-row {
        background-color: #f7f7f7;
        border-bottom: 1px solid #d6d5d5;
        justify-content: flex-end;
        height: 3.5rem;
        display: flex;
        align-items: center;
    }

        .top-row ::deep a, .top-row .btn-link {
            white-space: nowrap;
            margin-left: 1.5rem;
        }

        .top-row a:first-child {
            overflow: hidden;
            text-overflow: ellipsis;
        }

    @media (max-width: 767.98px) {
        .top-row:not(.auth) {
            display: none;
        }

        .top-row.auth {
            justify-content: space-between;
        }

        .top-row a, .top-row .btn-link {
            margin-left: 0;
        }
    }

    @media (min-width: 768px) {
        .page {
            flex-direction: row;
        }

        .sidebar {
            width: 250px;
            height: 100vh;
            position: sticky;
            top: 0;
        }

        .top-row {
            position: sticky;
            top: 0;
            z-index: 1;
        }

        .main > div {
            padding-left: 2rem !important;
            padding-right: 1.5rem !important;
        }
    }
    ```
    
    <span data-ttu-id="f6751-145">`NavMenu.razor.css`:</span><span class="sxs-lookup"><span data-stu-id="f6751-145">`NavMenu.razor.css`:</span></span>
    
    ```css
    .navbar-toggler {
        background-color: rgba(255, 255, 255, 0.1);
    }

    .top-row {
        height: 3.5rem;
        background-color: rgba(0,0,0,0.4);
    }

    .navbar-brand {
        font-size: 1.1rem;
    }

    .oi {
        width: 2rem;
        font-size: 1.1rem;
        vertical-align: text-top;
        top: -2px;
    }

    .nav-item {
        font-size: 0.9rem;
        padding-bottom: 0.5rem;
    }

        .nav-item:first-of-type {
            padding-top: 1rem;
        }

        .nav-item:last-of-type {
            padding-bottom: 1rem;
        }

        .nav-item ::deep a {
            color: #d7d7d7;
            border-radius: 4px;
            height: 3rem;
            display: flex;
            align-items: center;
            line-height: 3rem;
        }

    .nav-item ::deep a.active {
        background-color: rgba(255,255,255,0.25);
        color: white;
    }

    .nav-item ::deep a:hover {
        background-color: rgba(255,255,255,0.1);
        color: white;
    }

    @media (min-width: 768px) {
        .navbar-toggler {
            display: none;
        }

        .collapse {
            /* Never collapse the sidebar for wide screens */
            display: block;
        }
    }
    ```

1. <span data-ttu-id="f6751-146">アプリ `wwwroot/css/app.css` またはアプリのファイルの最新の基本ファイルには Blazor WebAssembly `wwwroot/css/site.css` Blazor Server 、次のスタイルが含まれています。</span><span class="sxs-lookup"><span data-stu-id="f6751-146">The latest base `wwwroot/css/app.css` file of a Blazor WebAssembly app or `wwwroot/css/site.css` file of a Blazor Server app includes the following styles.</span></span> <span data-ttu-id="f6751-147">次のスタイルとアプリに追加したものを残して、余分なスタイルを削除します。</span><span class="sxs-lookup"><span data-stu-id="f6751-147">Remove extra styles leaving the following styles and any that you've added to the app.</span></span>

    <span data-ttu-id="f6751-148">次のスタイルシートには基本スタイルのみが含まれており、開発者によって追加されたカスタムスタイルは含まれて **いません** 。</span><span class="sxs-lookup"><span data-stu-id="f6751-148">The following stylesheet only includes base styles and does **not** include custom styles added by the developer:</span></span>
   
    ```css
    @import url('open-iconic/font/css/open-iconic-bootstrap.min.css');

    html, body {
        font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
    }

    a, .btn-link {
        color: #0366d6;
    }

    .btn-primary {
        color: #fff;
        background-color: #1b6ec2;
        border-color: #1861ac;
    }

    .content {
        padding-top: 1.1rem;
    }

    .valid.modified:not([type=checkbox]) {
        outline: 1px solid #26b050;
    }

    .invalid {
        outline: 1px solid red;
    }

    .validation-message {
        color: red;
    }

    #blazor-error-ui {
        background: lightyellow;
        bottom: 0;
        box-shadow: 0 -1px 2px rgba(0, 0, 0, 0.2);
        display: none;
        left: 0;
        padding: 0.6rem 1.25rem 0.7rem 1.25rem;
        position: fixed;
        width: 100%;
        z-index: 1000;
    }

    #blazor-error-ui .dismiss {
        cursor: pointer;
        position: absolute;
        right: 0.75rem;
        top: 0.5rem;
    }
    ```

## <a name="update-no-locblazor-webassembly-projects"></a><span data-ttu-id="f6751-149">プロジェクトの更新 Blazor WebAssembly</span><span class="sxs-lookup"><span data-stu-id="f6751-149">Update Blazor WebAssembly projects</span></span>

<span data-ttu-id="f6751-150">前の「 [更新 Blazor WebAssembly と Blazor Server プロジェクト](#update-blazor-webassembly-and-blazor-server-projects) 」セクションのガイダンスに従ってください。</span><span class="sxs-lookup"><span data-stu-id="f6751-150">Follow the guidance in the preceding [Update Blazor WebAssembly and Blazor Server projects](#update-blazor-webassembly-and-blazor-server-projects) section.</span></span>

<span data-ttu-id="f6751-151">ホストされて Blazor WebAssembly いるソリューションのプロジェクトを含むプロジェクトの場合は、 *`Client`* Blazor 次の変更をプロジェクトファイルに適用します。</span><span class="sxs-lookup"><span data-stu-id="f6751-151">For a Blazor WebAssembly project, including the *`Client`* project of a hosted Blazor solution, apply the following changes to the project file:</span></span>

1. <span data-ttu-id="f6751-152">SDK をからに更新し `Microsoft.NET.Sdk.Web` `Microsoft.NET.Sdk.BlazorWebAssembly` ます。</span><span class="sxs-lookup"><span data-stu-id="f6751-152">Update the SDK from `Microsoft.NET.Sdk.Web` to `Microsoft.NET.Sdk.BlazorWebAssembly`:</span></span>

    ```diff
    - <Project Sdk="Microsoft.NET.Sdk.Web">
    + <Project Sdk="Microsoft.NET.Sdk.BlazorWebAssembly">
    ```
    
    > [!NOTE]
    > <span data-ttu-id="f6751-153">この更新プログラムは、スタンドアロン Blazor WebAssembly プロジェクトと *`Client`* ホスト型ソリューションのプロジェクトにのみ適用さ Blazor れます。</span><span class="sxs-lookup"><span data-stu-id="f6751-153">This update only applies to standalone Blazor WebAssembly projects and the *`Client`* projects of hosted Blazor solutions.</span></span>

1. <span data-ttu-id="f6751-154">次のプロパティを更新します。</span><span class="sxs-lookup"><span data-stu-id="f6751-154">Update the following properties:</span></span>

    ```diff
    <Project Sdk="Microsoft.NET.Sdk.BlazorWebAssembly">
    
      <PropertyGroup>
    -     <TargetFramework>netstandard2.1</TargetFramework>
    -     <RazorLangVersion>3.0</RazorLangVersion>
    +     <TargetFramework>net5.0</TargetFramework>
      </PropertyGroup>
    ```

1. <span data-ttu-id="f6751-155">AspNetCore へのパッケージの参照を削除します。 [ビルド](https://www.nuget.org/packages/Microsoft.AspNetCore.Components.WebAssembly.Build):</span><span class="sxs-lookup"><span data-stu-id="f6751-155">Remove the package reference to [Microsoft.AspNetCore.Components.WebAssembly.Build](https://www.nuget.org/packages/Microsoft.AspNetCore.Components.WebAssembly.Build):</span></span>

    ```diff
    <ItemGroup>
    -    <PackageReference Include="Microsoft.AspNetCore.Components.WebAssembly.Build" Version="3.2.1" PrivateAssets="all" />
    ```

1. <span data-ttu-id="f6751-156">他のパッケージを最新バージョンに更新します。</span><span class="sxs-lookup"><span data-stu-id="f6751-156">Update other packages to their latest versions.</span></span> <span data-ttu-id="f6751-157">最新バージョンについては、 [NuGet.org](https://www.nuget.org)を参照してください。</span><span class="sxs-lookup"><span data-stu-id="f6751-157">The latest versions can be found at [NuGet.org](https://www.nuget.org).</span></span>

1. <span data-ttu-id="f6751-158">で `wwwroot/index.html` 、コンポーネントを読み込む要素を、 `App` `<div>` がに設定された要素に変更し `id` `app` ます。</span><span class="sxs-lookup"><span data-stu-id="f6751-158">In `wwwroot/index.html`, change the element that loads the `App` component to a `<div>` element with an `id` set to `app`:</span></span>
    
    ```diff
    -<app>Loading...</app>
    +<div id="app">Loading...</div>
    ```
    
1. <span data-ttu-id="f6751-159">`Program.Main` (`Program.cs`):</span><span class="sxs-lookup"><span data-stu-id="f6751-159">In `Program.Main` (`Program.cs`):</span></span>

   * <span data-ttu-id="f6751-160">`<app>`ハッシュを追加して、要素への参照を CSS セレクターに変更し `#` ます。</span><span class="sxs-lookup"><span data-stu-id="f6751-160">Change the reference to the `<app>` element to a CSS selector by adding a hash `#` to it.</span></span>
   * <span data-ttu-id="f6751-161">`HttpClient`登録をスコープに変更します。</span><span class="sxs-lookup"><span data-stu-id="f6751-161">Change the `HttpClient` registration to scoped.</span></span>

    ```diff
    -builder.RootComponents.Add<App>("app");
    +builder.RootComponents.Add<App>("#app");
    
    -builder.Services.AddTransient(sp => new HttpClient 
    -    { BaseAddress = new Uri(builder.HostEnvironment.BaseAddress) });
    +builder.Services.AddScoped(sp => new HttpClient 
    +    { BaseAddress = new Uri(builder.HostEnvironment.BaseAddress) });
    ```

### <a name="standalone-no-locblazor-webassembly-app-with-microsoft-accounts"></a><span data-ttu-id="f6751-162">Blazor WebAssemblyMicrosoft アカウントを使用したスタンドアロンアプリ</span><span class="sxs-lookup"><span data-stu-id="f6751-162">Standalone Blazor WebAssembly app with Microsoft Accounts</span></span>

<span data-ttu-id="f6751-163">前の「 [update Blazor WebAssembly and Blazor Server projects](#update-blazor-webassembly-and-blazor-server-projects) and [update Blazor WebAssembly projects](#update-blazor-webassembly-projects) 」セクションのガイダンスに従ってください。</span><span class="sxs-lookup"><span data-stu-id="f6751-163">Follow the guidance in the preceding [Update Blazor WebAssembly and Blazor Server projects](#update-blazor-webassembly-and-blazor-server-projects) and [Update Blazor WebAssembly projects](#update-blazor-webassembly-projects) sections.</span></span>

<span data-ttu-id="f6751-164">Blazor WebAssemblyAzure portal に登録されているスタンドアロンアプリの場合、Azure Active Directory (AAD) を Microsoft アカウントに使用します。</span><span class="sxs-lookup"><span data-stu-id="f6751-164">For a standalone Blazor WebAssembly app registered in the Azure portal to use Azure Active Directory (AAD) for Microsoft Accounts:</span></span>

* <span data-ttu-id="f6751-165">アプリには、 `openid` スコープとスコープが必要です `offline_access` 。</span><span class="sxs-lookup"><span data-stu-id="f6751-165">The app requires the `openid` and `offline_access` scopes:</span></span>

  ```csharp
  options.ProviderOptions.DefaultAccessTokenScopes.Add("openid");
  options.ProviderOptions.DefaultAccessTokenScopes.Add("offline_access");
  ```
  
* <span data-ttu-id="f6751-166">[Azure portal アプリの登録 **認証** ブレード:</span><span class="sxs-lookup"><span data-stu-id="f6751-166">In the Azure portal app registration **Authentication** blade:</span></span>

  1. <span data-ttu-id="f6751-167">**Web** platform の構成を削除します。</span><span class="sxs-lookup"><span data-stu-id="f6751-167">Remove the **Web** platform configuration.</span></span>
  1. <span data-ttu-id="f6751-168">アプリのリダイレクト URI を使用して、 **シングルページアプリケーション** プラットフォーム構成を追加します。</span><span class="sxs-lookup"><span data-stu-id="f6751-168">Add a **Single-page application** platform configuration with the app's redirect URI.</span></span>
  1. <span data-ttu-id="f6751-169">**アクセストークン** と **ID トークン** の **暗黙的な許可** を無効にします。</span><span class="sxs-lookup"><span data-stu-id="f6751-169">Disable **Implicit grant** for **Access tokens** and **ID tokens**.</span></span>

<span data-ttu-id="f6751-170">詳細については、「<xref:blazor/security/webassembly/standalone-with-microsoft-accounts>」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="f6751-170">For more information, see <xref:blazor/security/webassembly/standalone-with-microsoft-accounts>.</span></span>

### <a name="standalone-no-locblazor-webassembly-app-with-azure-active-directory-aad"></a><span data-ttu-id="f6751-171">Blazor WebAssemblyAzure Active Directory を使用したスタンドアロンアプリ (AAD)</span><span class="sxs-lookup"><span data-stu-id="f6751-171">Standalone Blazor WebAssembly app with Azure Active Directory (AAD)</span></span>

<span data-ttu-id="f6751-172">前の「 [update Blazor WebAssembly and Blazor Server projects](#update-blazor-webassembly-and-blazor-server-projects) and [update Blazor WebAssembly projects](#update-blazor-webassembly-projects) 」セクションのガイダンスに従ってください。</span><span class="sxs-lookup"><span data-stu-id="f6751-172">Follow the guidance in the preceding [Update Blazor WebAssembly and Blazor Server projects](#update-blazor-webassembly-and-blazor-server-projects) and [Update Blazor WebAssembly projects](#update-blazor-webassembly-projects) sections.</span></span>

<span data-ttu-id="f6751-173">Blazor WebAssemblyAzure Active Directory (AAD) を使用するために Azure portal に登録されているスタンドアロンアプリの場合:</span><span class="sxs-lookup"><span data-stu-id="f6751-173">For a standalone Blazor WebAssembly app registered in the Azure portal to use Azure Active Directory (AAD):</span></span>

* <span data-ttu-id="f6751-174">アプリにはスコープが必要です `https://graph.microsoft.com/User.Read` 。</span><span class="sxs-lookup"><span data-stu-id="f6751-174">The app requires the `https://graph.microsoft.com/User.Read` scope:</span></span>

  ```csharp
  options.ProviderOptions.DefaultAccessTokenScopes
      .Add("https://graph.microsoft.com/User.Read");
  ```
  
* <span data-ttu-id="f6751-175">[Azure portal アプリの登録 **認証** ブレード:</span><span class="sxs-lookup"><span data-stu-id="f6751-175">In the Azure portal app registration **Authentication** blade:</span></span>

  1. <span data-ttu-id="f6751-176">**Web** platform の構成を削除します。</span><span class="sxs-lookup"><span data-stu-id="f6751-176">Remove the **Web** platform configuration.</span></span>
  1. <span data-ttu-id="f6751-177">アプリのリダイレクト URI を使用して、 **シングルページアプリケーション** プラットフォーム構成を追加します。</span><span class="sxs-lookup"><span data-stu-id="f6751-177">Add a **Single-page application** platform configuration with the app's redirect URI.</span></span>
  1. <span data-ttu-id="f6751-178">**アクセストークン** と **ID トークン** の **暗黙的な許可** を無効にします。</span><span class="sxs-lookup"><span data-stu-id="f6751-178">Disable **Implicit grant** for **Access tokens** and **ID tokens**.</span></span>
  
<span data-ttu-id="f6751-179">詳細については、「<xref:blazor/security/webassembly/standalone-with-azure-active-directory>」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="f6751-179">For more information, see <xref:blazor/security/webassembly/standalone-with-azure-active-directory>.</span></span>

### <a name="standalone-no-locblazor-webassembly-app-with-azure-active-directory-aad-b2c"></a><span data-ttu-id="f6751-180">Blazor WebAssemblyAzure Active Directory (AAD) B2C を使用したスタンドアロンアプリ</span><span class="sxs-lookup"><span data-stu-id="f6751-180">Standalone Blazor WebAssembly app with Azure Active Directory (AAD) B2C</span></span>

<span data-ttu-id="f6751-181">前の「 [update Blazor WebAssembly and Blazor Server projects](#update-blazor-webassembly-and-blazor-server-projects) and [update Blazor WebAssembly projects](#update-blazor-webassembly-projects) 」セクションのガイダンスに従ってください。</span><span class="sxs-lookup"><span data-stu-id="f6751-181">Follow the guidance in the preceding [Update Blazor WebAssembly and Blazor Server projects](#update-blazor-webassembly-and-blazor-server-projects) and [Update Blazor WebAssembly projects](#update-blazor-webassembly-projects) sections.</span></span>

<span data-ttu-id="f6751-182">Blazor WebAssemblyAzure portal に登録されているスタンドアロンアプリで Azure Active Directory (AAD) B2C を使用するには、次のようにします。</span><span class="sxs-lookup"><span data-stu-id="f6751-182">For a standalone Blazor WebAssembly app registered in the Azure portal to use Azure Active Directory (AAD) B2C:</span></span>

* <span data-ttu-id="f6751-183">アプリには、 `openid` スコープとスコープが必要です `offline_access` 。</span><span class="sxs-lookup"><span data-stu-id="f6751-183">The app requires the `openid` and `offline_access` scopes:</span></span>

  ```csharp
  options.ProviderOptions.DefaultAccessTokenScopes.Add("openid");
  options.ProviderOptions.DefaultAccessTokenScopes.Add("offline_access");
  ```
  
* <span data-ttu-id="f6751-184">[Azure portal アプリの登録 **認証** ブレード:</span><span class="sxs-lookup"><span data-stu-id="f6751-184">In the Azure portal app registration **Authentication** blade:</span></span>

  1. <span data-ttu-id="f6751-185">**Web** platform の構成を削除します。</span><span class="sxs-lookup"><span data-stu-id="f6751-185">Remove the **Web** platform configuration.</span></span>
  1. <span data-ttu-id="f6751-186">アプリのリダイレクト URI を使用して、 **シングルページアプリケーション** プラットフォーム構成を追加します。</span><span class="sxs-lookup"><span data-stu-id="f6751-186">Add a **Single-page application** platform configuration with the app's redirect URI.</span></span>
  1. <span data-ttu-id="f6751-187">**アクセストークン** と **ID トークン** の **暗黙的な許可** を無効にします。</span><span class="sxs-lookup"><span data-stu-id="f6751-187">Disable **Implicit grant** for **Access tokens** and **ID tokens**.</span></span>

<span data-ttu-id="f6751-188">詳細については、「<xref:blazor/security/webassembly/standalone-with-azure-active-directory-b2c>」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="f6751-188">For more information, see <xref:blazor/security/webassembly/standalone-with-azure-active-directory-b2c>.</span></span>

### <a name="hosted-no-locblazor-webassembly-app-with-azure-active-directory-aad-or-aad-b2c"></a><span data-ttu-id="f6751-189">Blazor WebAssemblyAzure Active Directory (AAD) または AAD B2C を使用したホストされたアプリ</span><span class="sxs-lookup"><span data-stu-id="f6751-189">Hosted Blazor WebAssembly app with Azure Active Directory (AAD) or AAD B2C</span></span>

<span data-ttu-id="f6751-190">前の「 [update Blazor WebAssembly and Blazor Server projects](#update-blazor-webassembly-and-blazor-server-projects) and [update Blazor WebAssembly projects](#update-blazor-webassembly-projects) 」セクションのガイダンスに従ってください。</span><span class="sxs-lookup"><span data-stu-id="f6751-190">Follow the guidance in the preceding [Update Blazor WebAssembly and Blazor Server projects](#update-blazor-webassembly-and-blazor-server-projects) and [Update Blazor WebAssembly projects](#update-blazor-webassembly-projects) sections.</span></span>

<span data-ttu-id="f6751-191">*`Client`* Blazor ユーザー認証に AAD または AAD B2C を使用するホスト型ソリューションのアプリ登録では、**単一ページアプリケーション** の Azure Apps プラットフォーム構成を使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="f6751-191">The *`Client`* app registration of a hosted Blazor solution that uses AAD or AAD B2C for user authentication should use a **Single-page application** Azure Apps platform configuration.</span></span>

<span data-ttu-id="f6751-192">[Azure portal *`Client`* アプリの登録 **認証** ブレード:</span><span class="sxs-lookup"><span data-stu-id="f6751-192">In the Azure portal *`Client`* app registration **Authentication** blade:</span></span>

  1. <span data-ttu-id="f6751-193">**Web** platform の構成を削除します。</span><span class="sxs-lookup"><span data-stu-id="f6751-193">Remove the **Web** platform configuration.</span></span>
  1. <span data-ttu-id="f6751-194">アプリのリダイレクト URI を使用して、 **シングルページアプリケーション** プラットフォーム構成を追加します。</span><span class="sxs-lookup"><span data-stu-id="f6751-194">Add a **Single-page application** platform configuration with the app's redirect URI.</span></span>
  1. <span data-ttu-id="f6751-195">**アクセストークン** と **ID トークン** の **暗黙的な許可** を無効にします。</span><span class="sxs-lookup"><span data-stu-id="f6751-195">Disable **Implicit grant** for **Access tokens** and **ID tokens**.</span></span>

<span data-ttu-id="f6751-196">詳細については次を参照してください:</span><span class="sxs-lookup"><span data-stu-id="f6751-196">For more information, see:</span></span>

* <xref:blazor/security/webassembly/hosted-with-azure-active-directory>
* <xref:blazor/security/webassembly/hosted-with-azure-active-directory-b2c>

### <a name="update-the-server-project-of-a-hosted-no-locblazor-solution"></a><span data-ttu-id="f6751-197">ホストされているソリューションのサーバープロジェクトを更新する Blazor</span><span class="sxs-lookup"><span data-stu-id="f6751-197">Update the Server project of a hosted Blazor solution</span></span>

<span data-ttu-id="f6751-198">前のセクションのガイダンスに従ってください。</span><span class="sxs-lookup"><span data-stu-id="f6751-198">Follow the guidance in the preceding sections:</span></span>

* [<span data-ttu-id="f6751-199">更新プログラム Blazor WebAssembly と Blazor Server プロジェクト</span><span class="sxs-lookup"><span data-stu-id="f6751-199">Update Blazor WebAssembly and Blazor Server projects</span></span>](#update-blazor-webassembly-and-blazor-server-projects)
* [<span data-ttu-id="f6751-200">プロジェクトの更新 Blazor WebAssembly</span><span class="sxs-lookup"><span data-stu-id="f6751-200">Update Blazor WebAssembly projects</span></span>](#update-blazor-webassembly-projects)
* <span data-ttu-id="f6751-201">Azure Active Directory によってアプリのプロバイダーに適用されるセクション。</span><span class="sxs-lookup"><span data-stu-id="f6751-201">The section that applies to the app's provider with Azure Active Directory:</span></span>
  * [<span data-ttu-id="f6751-202">Blazor WebAssemblyMicrosoft アカウントを使用したスタンドアロンアプリ</span><span class="sxs-lookup"><span data-stu-id="f6751-202">Standalone Blazor WebAssembly app with Microsoft Accounts</span></span>](#standalone-blazor-webassembly-app-with-microsoft-accounts)
  * [<span data-ttu-id="f6751-203">Blazor WebAssemblyAzure Active Directory を使用したスタンドアロンアプリ (AAD)</span><span class="sxs-lookup"><span data-stu-id="f6751-203">Standalone Blazor WebAssembly app with Azure Active Directory (AAD)</span></span>](#standalone-blazor-webassembly-app-with-azure-active-directory-aad)
  * [<span data-ttu-id="f6751-204">Blazor WebAssemblyAzure Active Directory (AAD) B2C を使用したスタンドアロンアプリ</span><span class="sxs-lookup"><span data-stu-id="f6751-204">Standalone Blazor WebAssembly app with Azure Active Directory (AAD) B2C</span></span>](#standalone-blazor-webassembly-app-with-azure-active-directory-aad-b2c)

<span data-ttu-id="f6751-205">*`Server`* Blazor この記事の一般的なガイダンスに従って、ホストされているソリューションのプロジェクトを ASP.NET Core アプリとして更新します。</span><span class="sxs-lookup"><span data-stu-id="f6751-205">Update the *`Server`* project of a hosted Blazor solution as an ASP.NET Core app following the general guidance in this article.</span></span>

<span data-ttu-id="f6751-206">さらに、 *`Server`* Azure Active Directory (AAD) または B2C を使用してクライアントアプリに対してユーザーを認証するプロジェクトでは、 Blazor WebAssembly 新しい Microsoft v2.0 パッケージを採用する必要があり Identity ます。</span><span class="sxs-lookup"><span data-stu-id="f6751-206">Additionally, *`Server`* projects that authenticate users to client Blazor WebAssembly apps with Azure Active Directory (AAD) or B2C should adopt new Microsoft Identity v2.0 packages:</span></span> 
  
<span data-ttu-id="f6751-207">AAD の場合:</span><span class="sxs-lookup"><span data-stu-id="f6751-207">For AAD:</span></span>

```diff
-<PackageReference Include="Microsoft.AspNetCore.Authentication.AzureAD.UI" Version="..." />
+<PackageReference Include="Microsoft.Identity.Web" Version="{VERSION}" />
+<PackageReference Include="Microsoft.Identity.Web.UI" Version="{VERSION}" />
```

<span data-ttu-id="f6751-208">AAD B2C の場合:</span><span class="sxs-lookup"><span data-stu-id="f6751-208">For AAD B2C:</span></span>

```diff
-<PackageReference Include="Microsoft.AspNetCore.Authentication.AzureADB2C.UI" Version="..." />
+<PackageReference Include="Microsoft.Identity.Web" Version="{VERSION}" />
+<PackageReference Include="Microsoft.Identity.Web.UI" Version="{VERSION}" />
```

<span data-ttu-id="f6751-209">上記のパッケージ参照については、NuGet.org でプレースホルダーのパッケージバージョンを確認し `{VERSION}` ます。</span><span class="sxs-lookup"><span data-stu-id="f6751-209">For the preceding package references, determine the package versions for the `{VERSION}` placeholders at NuGet.org:</span></span>

* [`Microsoft.Identity.Web`](https://www.nuget.org/packages/Microsoft.Identity.Web)
* [`Microsoft.Identity.Web.UI`](https://www.nuget.org/packages/Microsoft.Identity.Web.UI)

> [!NOTE]
> <span data-ttu-id="f6751-210">ホストされているソリューション内のプロジェクトの SDK は、 *`Server`* Blazor WebAssembly 次のように `Microsoft.NET.Sdk.Web` なります。</span><span class="sxs-lookup"><span data-stu-id="f6751-210">The SDK of the *`Server`* project in a hosted Blazor WebAssembly solution remains `Microsoft.NET.Sdk.Web`:</span></span>
>
> ```xml
> <Project Sdk="Microsoft.NET.Sdk.Web">
> ```

<span data-ttu-id="f6751-211">詳細については次を参照してください:</span><span class="sxs-lookup"><span data-stu-id="f6751-211">For more information, see:</span></span>

* <xref:blazor/security/webassembly/hosted-with-azure-active-directory>
* <xref:blazor/security/webassembly/hosted-with-azure-active-directory-b2c>

### <a name="clean-and-rebuild-the-solution"></a><span data-ttu-id="f6751-212">ソリューションのクリーンとリビルド</span><span class="sxs-lookup"><span data-stu-id="f6751-212">Clean and rebuild the solution</span></span>

<span data-ttu-id="f6751-213">アプリまたはソリューションを .NET 5 に移行した後、アプリまたはソリューションをクリーンにしてリビルドします。</span><span class="sxs-lookup"><span data-stu-id="f6751-213">After migrating the app or solution to .NET 5, clean and rebuild the app or solution.</span></span> <span data-ttu-id="f6751-214">新しいパッケージ参照とキャッシュされたパッケージの間にパッケージの互換性がない場合は、次のようにします。</span><span class="sxs-lookup"><span data-stu-id="f6751-214">If package incompatibilities exist between new package references and cached packages:</span></span>

1. <span data-ttu-id="f6751-215">コマンドシェルで次のコマンドを実行して、NuGet パッケージのキャッシュをクリアし [`dotnet nuget locals`](/dotnet/core/tools/dotnet-nuget-locals) ます。</span><span class="sxs-lookup"><span data-stu-id="f6751-215">Clear NuGet package caches by executing the following [`dotnet nuget locals`](/dotnet/core/tools/dotnet-nuget-locals) command in a command shell:</span></span>

   ```dotnetcli
   dotnet nuget locals --clear all
   ```
   
1. <span data-ttu-id="f6751-216">アプリまたはソリューションをクリーンにしてリビルドします。</span><span class="sxs-lookup"><span data-stu-id="f6751-216">Clean and rebuild the app or solution.</span></span>

### <a name="troubleshoot"></a><span data-ttu-id="f6751-217">トラブルシューティング</span><span class="sxs-lookup"><span data-stu-id="f6751-217">Troubleshoot</span></span>

<span data-ttu-id="f6751-218">アプリに適用されるセキュリティトピックの最後にある *トラブルシューティング* のガイダンスに従って Blazor WebAssembly ください。</span><span class="sxs-lookup"><span data-stu-id="f6751-218">Follow the *Troubleshoot* guidance at the end of the Blazor WebAssembly security topic that applies to your app:</span></span>

<span data-ttu-id="f6751-219">スタンドアロン Blazor WebAssembly アプリ:</span><span class="sxs-lookup"><span data-stu-id="f6751-219">Standalone Blazor WebAssembly apps:</span></span>

* [<span data-ttu-id="f6751-220">OIDC プロバイダーと WebAssembly 認証ライブラリ向けの一般的なガイダンス</span><span class="sxs-lookup"><span data-stu-id="f6751-220">General guidance for OIDC providers and the WebAssembly Authentication Library</span></span>](xref:blazor/security/webassembly/standalone-with-authentication-library)
* [<span data-ttu-id="f6751-221">Microsoft アカウント</span><span class="sxs-lookup"><span data-stu-id="f6751-221">Microsoft Accounts</span></span>](xref:blazor/security/webassembly/standalone-with-microsoft-accounts)
* [<span data-ttu-id="f6751-222">Azure Active Directory (AAD)</span><span class="sxs-lookup"><span data-stu-id="f6751-222">Azure Active Directory (AAD)</span></span>](xref:blazor/security/webassembly/standalone-with-azure-active-directory)
* [<span data-ttu-id="f6751-223">Azure Active Directory (AAD) B2C</span><span class="sxs-lookup"><span data-stu-id="f6751-223">Azure Active Directory (AAD) B2C</span></span>](xref:blazor/security/webassembly/standalone-with-azure-active-directory-b2c)

<span data-ttu-id="f6751-224">ホストされている Blazor WebAssembly アプリ:</span><span class="sxs-lookup"><span data-stu-id="f6751-224">Hosted Blazor WebAssembly apps:</span></span>

* [<span data-ttu-id="f6751-225">Azure Active Directory (AAD)</span><span class="sxs-lookup"><span data-stu-id="f6751-225">Azure Active Directory (AAD)</span></span>](xref:blazor/security/webassembly/hosted-with-azure-active-directory)
* [<span data-ttu-id="f6751-226">Azure Active Directory (AAD) B2C</span><span class="sxs-lookup"><span data-stu-id="f6751-226">Azure Active Directory (AAD) B2C</span></span>](xref:blazor/security/webassembly/hosted-with-azure-active-directory-b2c)
* [<span data-ttu-id="f6751-227">Identity サーバー</span><span class="sxs-lookup"><span data-stu-id="f6751-227">Identity Server</span></span>](xref:blazor/security/webassembly/hosted-with-identity-server)

### <a name="unauthorized-client-for-azure-active-directory-aad"></a><span data-ttu-id="f6751-228">Azure Active Directory の承認されていないクライアント (AAD)</span><span class="sxs-lookup"><span data-stu-id="f6751-228">Unauthorized client for Azure Active Directory (AAD)</span></span>

<span data-ttu-id="f6751-229">Blazor WebAssemblyAad を使用するアプリを認証にアップグレードした後、ユーザーが aad でサインインした後、ログインコールバックでアプリに対して次のエラーが表示されることがあります。</span><span class="sxs-lookup"><span data-stu-id="f6751-229">After upgrading a Blazor WebAssembly app that uses AAD for authentication, you may receive the following error on the login callback to the app after the user signs in with AAD:</span></span>

> <span data-ttu-id="f6751-230">情報:Microsoft.AspNetCore.Authorization.DefaultAuthorizationService[2] 承認に失敗しました。</span><span class="sxs-lookup"><span data-stu-id="f6751-230">info: Microsoft.AspNetCore.Authorization.DefaultAuthorizationService[2] Authorization failed.</span></span> <span data-ttu-id="f6751-231">次の要件が満たされていません。DenyAnonymousAuthorizationRequirement:認証済みユーザーが必要です。</span><span class="sxs-lookup"><span data-stu-id="f6751-231">These requirements were not met: DenyAnonymousAuthorizationRequirement: Requires an authenticated user.</span></span>

<span data-ttu-id="f6751-232">AAD からのログイン コールバック エラー:</span><span class="sxs-lookup"><span data-stu-id="f6751-232">Login callback error from AAD:</span></span>

* <span data-ttu-id="f6751-233">エラー: `unauthorized_client`</span><span class="sxs-lookup"><span data-stu-id="f6751-233">Error: `unauthorized_client`</span></span>
* <span data-ttu-id="f6751-234">説明: `AADB2C90058: The provided application is not configured to allow public clients.`</span><span class="sxs-lookup"><span data-stu-id="f6751-234">Description: `AADB2C90058: The provided application is not configured to allow public clients.`</span></span>

<span data-ttu-id="f6751-235">このエラーを解決するには:</span><span class="sxs-lookup"><span data-stu-id="f6751-235">To resolve the error:</span></span>

1. <span data-ttu-id="f6751-236">Azure portal で、[アプリのマニフェスト](/azure/active-directory/develop/reference-app-manifest)にアクセスします。</span><span class="sxs-lookup"><span data-stu-id="f6751-236">In the Azure portal, access the [app's manifest](/azure/active-directory/develop/reference-app-manifest).</span></span>
1. <span data-ttu-id="f6751-237">[`allowPublicClient`](/azure/active-directory/develop/reference-app-manifest#allowpublicclient-attribute) 属性を `null` または `true` に設定します。</span><span class="sxs-lookup"><span data-stu-id="f6751-237">Set the [`allowPublicClient`](/azure/active-directory/develop/reference-app-manifest#allowpublicclient-attribute) attribute to `null` or `true`.</span></span>

## <a name="update-a-no-locblazor-progressive-web-application-pwa"></a><span data-ttu-id="f6751-238">Blazorプログレッシブ Web アプリケーション (PWA) を更新する</span><span class="sxs-lookup"><span data-stu-id="f6751-238">Update a Blazor Progressive Web Application (PWA)</span></span>

<span data-ttu-id="f6751-239">PWA アプリのプロジェクトファイルに次の項目を追加します。</span><span class="sxs-lookup"><span data-stu-id="f6751-239">Add the following item to the PWA app's project file:</span></span>

```xml
<ItemGroup>
  <ServiceWorker Include="wwwroot\service-worker.js" 
    PublishedContent="wwwroot\service-worker.published.js" />
</ItemGroup>
```

## <a name="update-no-locrazor-class-libraries-rcls"></a><span data-ttu-id="f6751-240">Razorクラスライブラリの更新 (RCLs)</span><span class="sxs-lookup"><span data-stu-id="f6751-240">Update Razor class libraries (RCLs)</span></span>

<span data-ttu-id="f6751-241">RazorASP.NET Core 5.0 の一部として導入された新しい api または機能を利用するには、クラスライブラリ (RCLs) を移行します。</span><span class="sxs-lookup"><span data-stu-id="f6751-241">Migrate Razor class libraries (RCLs) to take advantage of new APIs or features that are introduced as part of ASP.NET Core 5.0.</span></span> 

<span data-ttu-id="f6751-242">コンポーネントを対象とする RCL を更新するには、次のようにします。</span><span class="sxs-lookup"><span data-stu-id="f6751-242">To update a RCL that targets components:</span></span>

1. <span data-ttu-id="f6751-243">プロジェクトファイルの次のプロパティを更新します。</span><span class="sxs-lookup"><span data-stu-id="f6751-243">Update the following properties in the project file:</span></span>

   ```diff
   <Project Sdk="Microsoft.NET.Sdk.Razor">
    
     <PropertyGroup>
   -     <TargetFramework>netstandard2.0</TargetFramework>
   -     <RazorLangVersion>3.0</RazorLangVersion>
   +     <TargetFramework>net5.0</TargetFramework>
     </PropertyGroup>
   ```

1. <span data-ttu-id="f6751-244">他のパッケージを最新バージョンに更新します。</span><span class="sxs-lookup"><span data-stu-id="f6751-244">Update other packages to their latest versions.</span></span> <span data-ttu-id="f6751-245">最新バージョンについては、 [NuGet.org](https://www.nuget.org)を参照してください。</span><span class="sxs-lookup"><span data-stu-id="f6751-245">The latest versions can be found at [NuGet.org](https://www.nuget.org).</span></span>

<span data-ttu-id="f6751-246">RCL をターゲットとする MVC を更新するには、プロジェクトファイルの次のプロパティを更新します。</span><span class="sxs-lookup"><span data-stu-id="f6751-246">To update an RCL targeting MVC, update the following properties in the project file:</span></span>

```diff
<Project Sdk="Microsoft.NET.Sdk.Razor">

  <PropertyGroup>
-    <TargetFramework>netcoreapp3.1</TargetFramework>
+    <TargetFramework>net5.0</TargetFramework>
    <AddRazorSupportForMvc>true</AddRazorSupportForMvc>
  </PropertyGroup>
```

## <a name="update-package-references"></a><span data-ttu-id="f6751-247">パッケージ参照の更新</span><span class="sxs-lookup"><span data-stu-id="f6751-247">Update package references</span></span>

<span data-ttu-id="f6751-248">プロジェクトファイルで、 [AspNetCore.](https://www.nuget.org/packages?q=Microsoft.AspNetCore.*)*、Microsoft. [entityframeworkcore. \*](https://www.nuget.org/packages?q=Microsoft.EntityFrameworkCore.*)、 [microsoft. Extensions.](https://www.nuget.org/packages?q=Microsoft.Extensions.*)* を更新し、パッケージ参照の属性 [ を](https://www.nuget.org/packages/System.Net.Http.Json) `Version` 5.0.0 以降にSystem.Net.Http.Jsします。</span><span class="sxs-lookup"><span data-stu-id="f6751-248">In the project file, update each [Microsoft.AspNetCore.\*](https://www.nuget.org/packages?q=Microsoft.AspNetCore.*), [Microsoft.EntityFrameworkCore.\*](https://www.nuget.org/packages?q=Microsoft.EntityFrameworkCore.*), [Microsoft.Extensions.\*](https://www.nuget.org/packages?q=Microsoft.Extensions.*), and [System.Net.Http.Json](https://www.nuget.org/packages/System.Net.Http.Json) package reference's `Version` attribute to 5.0.0 or later.</span></span> <span data-ttu-id="f6751-249">次に例を示します。</span><span class="sxs-lookup"><span data-stu-id="f6751-249">For example:</span></span>

```diff
<ItemGroup>
-    <PackageReference Include="Microsoft.AspNetCore.JsonPatch" Version="3.1.6" />
-    <PackageReference Include="Microsoft.EntityFrameworkCore.Tools" Version="3.1.6">
-    <PackageReference Include="Microsoft.Extensions.Caching.Abstractions" Version="3.1.6" />
-    <PackageReference Include="System.Net.Http.Json" Version="3.2.1" />
+    <PackageReference Include="Microsoft.AspNetCore.JsonPatch" Version="5.0.0" />
+    <PackageReference Include="Microsoft.EntityFrameworkCore.Tools" Version="5.0.0">
+    <PackageReference Include="Microsoft.Extensions.Caching.Abstractions" Version="5.0.0" />
+    <PackageReference Include="System.Net.Http.Json" Version="5.0.0" />
</ItemGroup>
```

## <a name="update-docker-images"></a><span data-ttu-id="f6751-250">Docker イメージの更新</span><span class="sxs-lookup"><span data-stu-id="f6751-250">Update Docker images</span></span>

<span data-ttu-id="f6751-251">Docker を使用するアプリでは、 *Dockerfile* `FROM` ステートメントとスクリプトを更新します。</span><span class="sxs-lookup"><span data-stu-id="f6751-251">For apps using Docker, update your *Dockerfile* `FROM` statements and scripts.</span></span> <span data-ttu-id="f6751-252">ASP.NET Core 5.0 ランタイムを含む基本イメージを使用します。</span><span class="sxs-lookup"><span data-stu-id="f6751-252">Use a base image that includes the ASP.NET Core 5.0 runtime.</span></span> <span data-ttu-id="f6751-253">`docker pull`ASP.NET Core 3.1 と5.0 の間で、次のコマンドの違いを考慮してください。</span><span class="sxs-lookup"><span data-stu-id="f6751-253">Consider the following `docker pull` command difference between ASP.NET Core 3.1 and 5.0:</span></span>

```diff
- docker pull mcr.microsoft.com/dotnet/core/aspnet:3.1
+ docker pull mcr.microsoft.com/dotnet/aspnet:5.0
```

<span data-ttu-id="f6751-254">製品名として ".NET" への移行の一環として、Docker イメージはリポジトリからに移動されました `mcr.microsoft.com/dotnet/core` `mcr.microsoft.com/dotnet` 。</span><span class="sxs-lookup"><span data-stu-id="f6751-254">As part of the move to ".NET" as the product name, the Docker images moved from the `mcr.microsoft.com/dotnet/core` repositories to `mcr.microsoft.com/dotnet`.</span></span> <span data-ttu-id="f6751-255">詳細については、「 [dotnet/dotnet-docker # 1939](https://github.com/dotnet/dotnet-docker/issues/1939)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="f6751-255">For more information, see [dotnet/dotnet-docker#1939](https://github.com/dotnet/dotnet-docker/issues/1939).</span></span>

## <a name="model-binding-changes-in-aspnet-core-mvc-and-no-locrazor-pages"></a><span data-ttu-id="f6751-256">MVC とページ ASP.NET Core のモデルバインドの変更 Razor</span><span class="sxs-lookup"><span data-stu-id="f6751-256">Model binding changes in ASP.NET Core MVC and Razor Pages</span></span>

### <a name="datetime-values-are-model-bound-as-utc-times"></a><span data-ttu-id="f6751-257">DateTime 値は、UTC 時刻としてモデルにバインドされます</span><span class="sxs-lookup"><span data-stu-id="f6751-257">DateTime values are model bound as UTC times</span></span>

<span data-ttu-id="f6751-258">3.1 以前のバージョン ASP.NET Core では、値は、 `DateTime` タイムゾーンがサーバーによって決定された、ローカル時刻としてモデルにバインドされていました。</span><span class="sxs-lookup"><span data-stu-id="f6751-258">In ASP.NET Core 3.1 and earlier, `DateTime` values were model-bound as local time, where the timezone was determined by the server.</span></span> <span data-ttu-id="f6751-259">`DateTime` 入力形式 (JSON) と値からバインドされた値は、 `DateTimeOffset` UTC タイムゾーンとしてバインドされました。</span><span class="sxs-lookup"><span data-stu-id="f6751-259">`DateTime` values bound from input formatting (JSON) and `DateTimeOffset` values were bound as UTC timezones.</span></span>

<span data-ttu-id="f6751-260">ASP.NET Core 5.0 以降では、モデルバインドは常に `DateTime` UTC タイムゾーンを使用して値をバインドします。</span><span class="sxs-lookup"><span data-stu-id="f6751-260">In ASP.NET Core 5.0 and later, model binding consistently binds `DateTime` values with the UTC timezone.</span></span>

<span data-ttu-id="f6751-261">以前の動作を保持するには、のを削除し `DateTimeModelBinderProvider` `Startup.ConfigureServices` ます。</span><span class="sxs-lookup"><span data-stu-id="f6751-261">To retain the previous behavior, remove the `DateTimeModelBinderProvider` in `Startup.ConfigureServices`:</span></span>

```csharp
services.AddControllersWithViews(options => 
    options.ModelBinderProviders.RemoveType<DateTimeModelBinderProvider>());
```

### <a name="complexobjectmodelbinderprovider--complexobjectmodelbinder-replace-complextypemodelbinderprovider--complextypemodelbinder"></a><span data-ttu-id="f6751-262">ComplexObjectModelBinderProvider \ ComplexObjectModelBinder replace ComplexTypeModelBinderProvider \ ComplexTypeModelBinder</span><span class="sxs-lookup"><span data-stu-id="f6751-262">ComplexObjectModelBinderProvider \ ComplexObjectModelBinder replace ComplexTypeModelBinderProvider \ ComplexTypeModelBinder</span></span>

<span data-ttu-id="f6751-263">モデルバインド [C# 9 レコードの種類](/dotnet/csharp/whats-new/csharp-9#record-types)のサポートを追加するには、次のようにし <xref:Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexTypeModelBinderProvider> ます。</span><span class="sxs-lookup"><span data-stu-id="f6751-263">To add support for model binding [C# 9 record types](/dotnet/csharp/whats-new/csharp-9#record-types), the <xref:Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexTypeModelBinderProvider> is:</span></span>

* <span data-ttu-id="f6751-264">不使用として注釈が付けられます。</span><span class="sxs-lookup"><span data-stu-id="f6751-264">Annotated as obsolete.</span></span>
* <span data-ttu-id="f6751-265">既定では登録されなくなりました。</span><span class="sxs-lookup"><span data-stu-id="f6751-265">No longer registered by default.</span></span>

<span data-ttu-id="f6751-266">コレクション内のの存在に依存するアプリは、 `ComplexTypeModelBinderProvider` `ModelBinderProviders` 新しいバインダープロバイダーを参照する必要があります。</span><span class="sxs-lookup"><span data-stu-id="f6751-266">Apps that rely on the presence of the `ComplexTypeModelBinderProvider` in the `ModelBinderProviders` collection need to reference the new binder provider:</span></span>

```diff
- var complexModelBinderProvider = options.ModelBinderProviders.OfType<ComplexTypeModelBinderProvider>();
+ var complexModelBinderProvider = options.ModelBinderProviders.OfType<ComplexObjectModelBinderProvider>();
```

## <a name="usedatabaseerrorpage-obsolete"></a><span data-ttu-id="f6751-267">UseDatabaseErrorPage obsolete</span><span class="sxs-lookup"><span data-stu-id="f6751-267">UseDatabaseErrorPage obsolete</span></span>

<span data-ttu-id="f6751-268">個々のユーザーアカウントのオプションを含む ASP.NET Core 3.1 テンプレートでは、への呼び出しが生成され <xref:Microsoft.AspNetCore.Builder.DatabaseErrorPageExtensions.UseDatabaseErrorPage%2A> ます。</span><span class="sxs-lookup"><span data-stu-id="f6751-268">The ASP.NET Core 3.1 templates that include an option for individual user accounts generate a call to <xref:Microsoft.AspNetCore.Builder.DatabaseErrorPageExtensions.UseDatabaseErrorPage%2A>.</span></span> <span data-ttu-id="f6751-269">`UseDatabaseErrorPage` は互換性のために残されているので `AddDatabaseDeveloperPageExceptionFilter` 、 `UseMigrationsEndPoint` 次のコードに示すように、との組み合わせで置き換える必要があります。</span><span class="sxs-lookup"><span data-stu-id="f6751-269">`UseDatabaseErrorPage` is now obsolete and should be replaced with a combination of `AddDatabaseDeveloperPageExceptionFilter` and `UseMigrationsEndPoint`, as shown in the following code:</span></span>

```diff
public void ConfigureServices(IServiceCollection services)
{
    services.AddDbContext<ApplicationDbContext>(options =>
        options.UseSqlServer(
            Configuration.GetConnectionString("DefaultConnection")));
+   services.AddDatabaseDeveloperPageExceptionFilter();
    services.AddDefaultIdentity<IdentityUser>(options => options.SignIn.RequireConfirmedAccount = true)
        .AddEntityFrameworkStores<ApplicationDbContext>();
    services.AddRazorPages();
}

public void Configure(IApplicationBuilder app, IWebHostEnvironment env)
{
    if (env.IsDevelopment())
    {
        app.UseDeveloperExceptionPage();
+       app.UseMigrationsEndPoint()
-       app.UseDatabaseErrorPage();
    }
    else
    {
        app.UseExceptionHandler("/Error");
        app.UseHsts();
    }
```

<span data-ttu-id="f6751-270">詳細については、次を参照してください。[この GitHub の問題](https://github.com/dotnet/aspnetcore/issues/24987)します。</span><span class="sxs-lookup"><span data-stu-id="f6751-270">For more information, see [this GitHub issue](https://github.com/dotnet/aspnetcore/issues/24987).</span></span>

## <a name="review-breaking-changes"></a><span data-ttu-id="f6751-271">重大な変更の確認</span><span class="sxs-lookup"><span data-stu-id="f6751-271">Review breaking changes</span></span>

<span data-ttu-id="f6751-272">.NET Core 3.1 から .NET 5.0 への重大な変更については、「 [バージョン3.1 から5.0 への移行に関する重大な変更](/dotnet/core/compatibility/3.1-5.0)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="f6751-272">For breaking changes from .NET Core 3.1 to .NET 5.0, see [Breaking changes for migration from version 3.1 to 5.0](/dotnet/core/compatibility/3.1-5.0).</span></span> <span data-ttu-id="f6751-273">ASP.NET Core と Entity Framework Core も一覧に含まれています。</span><span class="sxs-lookup"><span data-stu-id="f6751-273">ASP.NET Core and Entity Framework Core are also included in the list.</span></span>

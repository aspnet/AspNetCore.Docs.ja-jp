---
title: ASP.NET Core 3.1 から5.0 への移行
author: scottaddie
description: ASP.NET Core 3.1 プロジェクトを ASP.NET Core 5.0 に移行する方法について説明します。
ms.author: scaddie
ms.custom: mvc
ms.date: 11/17/2020
no-loc:
- appsettings.json
- ASP.NET Core Identity
- cookie
- Cookie
- Blazor
- Blazor Server
- Blazor WebAssembly
- Identity
- Let's Encrypt
- Razor
- SignalR
uid: migration/31-to-50
ms.openlocfilehash: ea746d0b5292841b0a36f4deaded8fbae8472220
ms.sourcegitcommit: 54fdca99f30b18d69cf0753ca3c84c7dab8f2b0e
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/17/2020
ms.locfileid: "94691184"
---
# <a name="migrate-from-aspnet-core-31-to-50"></a><span data-ttu-id="a8a40-103">ASP.NET Core 3.1 から5.0 への移行</span><span class="sxs-lookup"><span data-stu-id="a8a40-103">Migrate from ASP.NET Core 3.1 to 5.0</span></span>

<span data-ttu-id="a8a40-104">作成者: [Scott Addie](https://github.com/scottaddie)</span><span class="sxs-lookup"><span data-stu-id="a8a40-104">By [Scott Addie](https://github.com/scottaddie)</span></span>

<span data-ttu-id="a8a40-105">この記事では、既存の ASP.NET Core 3.1 プロジェクトを ASP.NET Core 5.0 に更新する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="a8a40-105">This article explains how to update an existing ASP.NET Core 3.1 project to ASP.NET Core 5.0.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="a8a40-106">必須コンポーネント</span><span class="sxs-lookup"><span data-stu-id="a8a40-106">Prerequisites</span></span>

# <a name="visual-studio"></a>[<span data-ttu-id="a8a40-107">Visual Studio</span><span class="sxs-lookup"><span data-stu-id="a8a40-107">Visual Studio</span></span>](#tab/visual-studio)

[!INCLUDE[](~/includes/net-core-prereqs-vs-5.0.md)]

# <a name="visual-studio-code"></a>[<span data-ttu-id="a8a40-108">Visual Studio Code</span><span class="sxs-lookup"><span data-stu-id="a8a40-108">Visual Studio Code</span></span>](#tab/visual-studio-code)

[!INCLUDE[](~/includes/net-core-prereqs-vsc-5.0.md)]

# <a name="visual-studio-for-mac"></a>[<span data-ttu-id="a8a40-109">Visual Studio for Mac</span><span class="sxs-lookup"><span data-stu-id="a8a40-109">Visual Studio for Mac</span></span>](#tab/visual-studio-mac)

[!INCLUDE[](~/includes/net-core-prereqs-mac-5.0.md)]

---

## <a name="update-net-core-sdk-version-in-globaljson"></a><span data-ttu-id="a8a40-110">global.json での .NET Core SDK バージョンの更新</span><span class="sxs-lookup"><span data-stu-id="a8a40-110">Update .NET Core SDK version in global.json</span></span>

<span data-ttu-id="a8a40-111">ファイル [ のglobal.js](/dotnet/core/tools/global-json) に依存して特定の .NET Core SDK バージョンを対象とする場合は、 `version` インストールされている .net 5.0 SDK バージョンにプロパティを更新します。</span><span class="sxs-lookup"><span data-stu-id="a8a40-111">If you rely upon a [global.json](/dotnet/core/tools/global-json) file to target a specific .NET Core SDK version, update the `version` property to the .NET 5.0 SDK version that's installed.</span></span> <span data-ttu-id="a8a40-112">次に例を示します。</span><span class="sxs-lookup"><span data-stu-id="a8a40-112">For example:</span></span>

```diff
{
  "sdk": {
-    "version": "3.1.200"
+    "version": "5.0.100"
  }
}
```

## <a name="update-the-target-framework"></a><span data-ttu-id="a8a40-113">ターゲットフレームワークを更新する</span><span class="sxs-lookup"><span data-stu-id="a8a40-113">Update the target framework</span></span>

<span data-ttu-id="a8a40-114">プロジェクトを更新 Blazor WebAssembly する場合は、「 [ Blazor WebAssembly プロジェクトの更新](#update-blazor-webassembly-projects) 」セクションに進みます。</span><span class="sxs-lookup"><span data-stu-id="a8a40-114">If updating a Blazor WebAssembly project, skip to the [Update Blazor WebAssembly projects](#update-blazor-webassembly-projects) section.</span></span> <span data-ttu-id="a8a40-115">その他の ASP.NET Core プロジェクトの種類については、プロジェクトファイルの [ターゲットフレームワークモニカー (TFM)](/dotnet/standard/frameworks) を次のように更新し `net5.0` ます。</span><span class="sxs-lookup"><span data-stu-id="a8a40-115">For any other ASP.NET Core project type, update the project file's [Target Framework Moniker (TFM)](/dotnet/standard/frameworks) to `net5.0`:</span></span>

```diff
<Project Sdk="Microsoft.NET.Sdk.Web">

  <PropertyGroup>
-    <TargetFramework>netcoreapp3.1</TargetFramework>
+    <TargetFramework>net5.0</TargetFramework>
  </PropertyGroup>

</Project>
```

## <a name="update-no-locblazor-webassembly-and-no-locblazor-server-projects"></a><span data-ttu-id="a8a40-116">更新プログラム Blazor WebAssembly と Blazor Server プロジェクト</span><span class="sxs-lookup"><span data-stu-id="a8a40-116">Update Blazor WebAssembly and Blazor Server projects</span></span>

<span data-ttu-id="a8a40-117">*このセクションのガイダンスは、両方の Blazor ホストモデルに適用されます。このセクションの後のセクションでは、ホスティングモデルとアプリの種類に固有の追加のガイダンスを提供します。関連するすべてのセクションの guidnace をアプリに適用します。*</span><span class="sxs-lookup"><span data-stu-id="a8a40-117">*The guidance in this section applies to both Blazor hosting models. Sections following this section provide additional guidance specific to hosting models and app types. Apply the guidnace from all relevant sections to your app.*</span></span>

1. <span data-ttu-id="a8a40-118">アプリまたはアプリので、 `wwwroot/index.html` Blazor WebAssembly `Pages/_Host.cshtml` Blazor Server `<link>` スタイルの要素に要素を追加し `<head>` ます。</span><span class="sxs-lookup"><span data-stu-id="a8a40-118">In `wwwroot/index.html` of a Blazor WebAssembly app or the `Pages/_Host.cshtml` of a Blazor Server app, add a `<link>` element to the `<head>` element for styles.</span></span> <span data-ttu-id="a8a40-119">次の `<link>` 要素 `href` 属性値では、プレースホルダー `{ASSEMBLY NAME}` はアプリのアセンブリ名です。</span><span class="sxs-lookup"><span data-stu-id="a8a40-119">In the following `<link>` element `href` attribute values, the placeholder `{ASSEMBLY NAME}` is the app's assembly name.</span></span>

    ```diff
    +<link href="{ASSEMBLY NAME}.styles.css" rel="stylesheet" />
    ```
    
    <span data-ttu-id="a8a40-120">スタンドアロン Blazor WebAssembly または Blazor Server 例:</span><span class="sxs-lookup"><span data-stu-id="a8a40-120">Standalone Blazor WebAssembly or Blazor Server example:</span></span>
    
    ```diff
    +<link href="BlazorSample.styles.css" rel="stylesheet" />
    ```

    <span data-ttu-id="a8a40-121">*`Client`* ホストされているソリューションのプロジェクトの Blazor WebAssembly 例:</span><span class="sxs-lookup"><span data-stu-id="a8a40-121">*`Client`* project of a hosted Blazor WebAssembly solution example:</span></span>
    
    ```diff
    +<link href="BlazorSample.Client.styles.css" rel="stylesheet" />
    ```

1. <span data-ttu-id="a8a40-122">`_Imports.razor`[コンポーネントの仮想化](xref:blazor/components/virtualization)用に、アプリのファイルに新しい名前空間を含め <xref:Microsoft.AspNetCore.Components.Web.Virtualization?displayProperty=fullName> ます。</span><span class="sxs-lookup"><span data-stu-id="a8a40-122">Include a new namespace in the app's `_Imports.razor` file for [component virtualization](xref:blazor/components/virtualization), <xref:Microsoft.AspNetCore.Components.Web.Virtualization?displayProperty=fullName>.</span></span> <span data-ttu-id="a8a40-123">次の `_Imports.razor` ファイルは、プロジェクトテンプレートから生成されたアプリの既定の名前空間を示して Blazor います。</span><span class="sxs-lookup"><span data-stu-id="a8a40-123">The following `_Imports.razor` files show the default namespaces in apps generated from the Blazor project templates.</span></span> <span data-ttu-id="a8a40-124">プレースホルダー `{ASSEMBLY NAME}` は、アプリのアセンブリ名です。</span><span class="sxs-lookup"><span data-stu-id="a8a40-124">The placeholder `{ASSEMBLY NAME}` is the app's assembly name.</span></span>

   <span data-ttu-id="a8a40-125">Blazor WebAssembly (`_Imports.razor`):</span><span class="sxs-lookup"><span data-stu-id="a8a40-125">Blazor WebAssembly (`_Imports.razor`):</span></span>
   
   ```razor
   @using System.Net.Http
   @using System.Net.Http.Json
   @using Microsoft.AspNetCore.Components.Forms
   @using Microsoft.AspNetCore.Components.Routing
   @using Microsoft.AspNetCore.Components.Web
   @using Microsoft.AspNetCore.Components.Web.Virtualization
   @using Microsoft.AspNetCore.Components.WebAssembly.Http
   @using Microsoft.JSInterop
   @using {ASSEMBLY NAME}
   @using {ASSEMBLY NAME}.Shared
   ```

   <span data-ttu-id="a8a40-126">Blazor Server (`_Imports.razor`):</span><span class="sxs-lookup"><span data-stu-id="a8a40-126">Blazor Server (`_Imports.razor`):</span></span>
   
   ```razor
   @using System.Net.Http
   @using Microsoft.AspNetCore.Authorization
   @using Microsoft.AspNetCore.Components.Authorization
   @using Microsoft.AspNetCore.Components.Forms
   @using Microsoft.AspNetCore.Components.Routing
   @using Microsoft.AspNetCore.Components.Web
   @using Microsoft.AspNetCore.Components.Web.Virtualization
   @using Microsoft.JSInterop
   @using {ASSEMBLY NAME}
   @using {ASSEMBLY NAME}.Shared
   ```
   
1. <span data-ttu-id="a8a40-127">`MainLayout`コンポーネント () で `Shared/MainLayout.razor` 、コンポーネントの HTML マークアップを、 `<div>` 属性がに設定された要素で囲み `class` `page` ます。</span><span class="sxs-lookup"><span data-stu-id="a8a40-127">In the `MainLayout` component (`Shared/MainLayout.razor`), surround the component's HTML markup with a `<div>` element that has a `class` attribute set to `page`:</span></span>

    ```razor
    <div class="page">
    
        ...
        
    </div>
    ```
    
1. <span data-ttu-id="a8a40-128">次のファイルをフォルダーに追加し `Shared` ます。</span><span class="sxs-lookup"><span data-stu-id="a8a40-128">Add the following files to the `Shared` folder:</span></span>

    <span data-ttu-id="a8a40-129">`MainLayout.razor.css`:</span><span class="sxs-lookup"><span data-stu-id="a8a40-129">`MainLayout.razor.css`:</span></span>
    
    ```css
    .page {
        position: relative;
        display: flex;
        flex-direction: column;
    }

    .main {
        flex: 1;
    }

    .sidebar {
        background-image: linear-gradient(180deg, rgb(5, 39, 103) 0%, #3a0647 70%);
    }

    .top-row {
        background-color: #f7f7f7;
        border-bottom: 1px solid #d6d5d5;
        justify-content: flex-end;
        height: 3.5rem;
        display: flex;
        align-items: center;
    }

        .top-row ::deep a, .top-row .btn-link {
            white-space: nowrap;
            margin-left: 1.5rem;
        }

        .top-row a:first-child {
            overflow: hidden;
            text-overflow: ellipsis;
        }

    @media (max-width: 767.98px) {
        .top-row:not(.auth) {
            display: none;
        }

        .top-row.auth {
            justify-content: space-between;
        }

        .top-row a, .top-row .btn-link {
            margin-left: 0;
        }
    }

    @media (min-width: 768px) {
        .page {
            flex-direction: row;
        }

        .sidebar {
            width: 250px;
            height: 100vh;
            position: sticky;
            top: 0;
        }

        .top-row {
            position: sticky;
            top: 0;
            z-index: 1;
        }

        .main > div {
            padding-left: 2rem !important;
            padding-right: 1.5rem !important;
        }
    }
    ```
    
    <span data-ttu-id="a8a40-130">`NavMenu.razor.css`:</span><span class="sxs-lookup"><span data-stu-id="a8a40-130">`NavMenu.razor.css`:</span></span>
    
    ```css
    .navbar-toggler {
        background-color: rgba(255, 255, 255, 0.1);
    }

    .top-row {
        height: 3.5rem;
        background-color: rgba(0,0,0,0.4);
    }

    .navbar-brand {
        font-size: 1.1rem;
    }

    .oi {
        width: 2rem;
        font-size: 1.1rem;
        vertical-align: text-top;
        top: -2px;
    }

    .nav-item {
        font-size: 0.9rem;
        padding-bottom: 0.5rem;
    }

        .nav-item:first-of-type {
            padding-top: 1rem;
        }

        .nav-item:last-of-type {
            padding-bottom: 1rem;
        }

        .nav-item ::deep a {
            color: #d7d7d7;
            border-radius: 4px;
            height: 3rem;
            display: flex;
            align-items: center;
            line-height: 3rem;
        }

    .nav-item ::deep a.active {
        background-color: rgba(255,255,255,0.25);
        color: white;
    }

    .nav-item ::deep a:hover {
        background-color: rgba(255,255,255,0.1);
        color: white;
    }

    @media (min-width: 768px) {
        .navbar-toggler {
            display: none;
        }

        .collapse {
            /* Never collapse the sidebar for wide screens */
            display: block;
        }
    }
    ```

1. <span data-ttu-id="a8a40-131">アプリ `wwwroot/css/app.css` またはアプリのファイルの最新の基本ファイルには Blazor WebAssembly `wwwroot/css/site.css` Blazor Server 、次のスタイルが含まれています。</span><span class="sxs-lookup"><span data-stu-id="a8a40-131">The latest base `wwwroot/css/app.css` file of a Blazor WebAssembly app or `wwwroot/css/site.css` file of a Blazor Server app includes the following styles.</span></span> <span data-ttu-id="a8a40-132">次のスタイルとアプリに追加したものを残して、余分なスタイルを削除します。</span><span class="sxs-lookup"><span data-stu-id="a8a40-132">Remove extra styles leaving the following styles and any that you've added to the app.</span></span>

    <span data-ttu-id="a8a40-133">次のスタイルシートには基本スタイルのみが含まれており、開発者によって追加されたカスタムスタイルは含まれて **いません** 。</span><span class="sxs-lookup"><span data-stu-id="a8a40-133">The following stylesheet only includes base styles and does **not** include custom styles added by the developer:</span></span>
   
    ```css
    @import url('open-iconic/font/css/open-iconic-bootstrap.min.css');

    html, body {
        font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
    }

    a, .btn-link {
        color: #0366d6;
    }

    .btn-primary {
        color: #fff;
        background-color: #1b6ec2;
        border-color: #1861ac;
    }

    .content {
        padding-top: 1.1rem;
    }

    .valid.modified:not([type=checkbox]) {
        outline: 1px solid #26b050;
    }

    .invalid {
        outline: 1px solid red;
    }

    .validation-message {
        color: red;
    }

    #blazor-error-ui {
        background: lightyellow;
        bottom: 0;
        box-shadow: 0 -1px 2px rgba(0, 0, 0, 0.2);
        display: none;
        left: 0;
        padding: 0.6rem 1.25rem 0.7rem 1.25rem;
        position: fixed;
        width: 100%;
        z-index: 1000;
    }

    #blazor-error-ui .dismiss {
        cursor: pointer;
        position: absolute;
        right: 0.75rem;
        top: 0.5rem;
    }
    ```

## <a name="update-no-locblazor-webassembly-projects"></a><span data-ttu-id="a8a40-134">プロジェクトの更新 Blazor WebAssembly</span><span class="sxs-lookup"><span data-stu-id="a8a40-134">Update Blazor WebAssembly projects</span></span>

<span data-ttu-id="a8a40-135">ホストされて Blazor WebAssembly いるソリューションのプロジェクトを含むプロジェクトの場合は、 *`Client`* Blazor 次の変更をプロジェクトファイルに適用します。</span><span class="sxs-lookup"><span data-stu-id="a8a40-135">For a Blazor WebAssembly project, including the *`Client`* project of a hosted Blazor solution, apply the following changes to the project file:</span></span>

1. <span data-ttu-id="a8a40-136">SDK をからに更新し `Microsoft.NET.Sdk.Web` `Microsoft.NET.Sdk.BlazorWebAssembly` ます。</span><span class="sxs-lookup"><span data-stu-id="a8a40-136">Update the SDK from `Microsoft.NET.Sdk.Web` to `Microsoft.NET.Sdk.BlazorWebAssembly`:</span></span>

    ```diff
    - <Project Sdk="Microsoft.NET.Sdk.Web">
    + <Project Sdk="Microsoft.NET.Sdk.BlazorWebAssembly">
    ```
    
    > [!NOTE]
    > <span data-ttu-id="a8a40-137">この更新プログラムは、スタンドアロン Blazor WebAssembly プロジェクトと *`Client`* ホスト型ソリューションのプロジェクトにのみ適用さ Blazor れます。</span><span class="sxs-lookup"><span data-stu-id="a8a40-137">This update only applies to standalone Blazor WebAssembly projects and the *`Client`* projects of hosted Blazor solutions.</span></span>

1. <span data-ttu-id="a8a40-138">次のプロパティを更新します。</span><span class="sxs-lookup"><span data-stu-id="a8a40-138">Update the following properties:</span></span>

    ```diff
    <Project Sdk="Microsoft.NET.Sdk.BlazorWebAssembly">
    
      <PropertyGroup>
    -     <TargetFramework>netstandard2.1</TargetFramework>
    -     <RazorLangVersion>3.0</RazorLangVersion>
    +     <TargetFramework>net5.0</TargetFramework>
      </PropertyGroup>
    ```

1. <span data-ttu-id="a8a40-139">AspNetCore へのパッケージの参照を削除します。 [ビルド](https://www.nuget.org/packages/Microsoft.AspNetCore.Components.WebAssembly.Build):</span><span class="sxs-lookup"><span data-stu-id="a8a40-139">Remove the package reference to [Microsoft.AspNetCore.Components.WebAssembly.Build](https://www.nuget.org/packages/Microsoft.AspNetCore.Components.WebAssembly.Build):</span></span>

    ```diff
    <ItemGroup>
    -    <PackageReference Include="Microsoft.AspNetCore.Components.WebAssembly.Build" Version="3.2.1" PrivateAssets="all" />
    ```

1. <span data-ttu-id="a8a40-140">他のパッケージを最新バージョンに更新します。</span><span class="sxs-lookup"><span data-stu-id="a8a40-140">Update other packages to their latest versions.</span></span> <span data-ttu-id="a8a40-141">最新バージョンについては、 [NuGet.org](https://www.nuget.org)を参照してください。</span><span class="sxs-lookup"><span data-stu-id="a8a40-141">The latest versions can be found at [NuGet.org](https://www.nuget.org).</span></span>

1. <span data-ttu-id="a8a40-142">で `wwwroot/index.html` 、コンポーネントを読み込む要素を変更し `App` ます。</span><span class="sxs-lookup"><span data-stu-id="a8a40-142">In `wwwroot/index.html`, change the element that loads the `App` component:</span></span>
    
    ```diff
    -<app>Loading...</app>
    +<app id="app">Loading...</app>
    ```
    
1. <span data-ttu-id="a8a40-143">`Program.Main` (`Program.cs`):</span><span class="sxs-lookup"><span data-stu-id="a8a40-143">In `Program.Main` (`Program.cs`):</span></span>

   * <span data-ttu-id="a8a40-144">`<app>`ハッシュを追加して、要素への参照を CSS セレクターに変更し `#` ます。</span><span class="sxs-lookup"><span data-stu-id="a8a40-144">Change the reference to the `<app>` element to a CSS selector by adding a hash `#` to it.</span></span>
   * <span data-ttu-id="a8a40-145">`HttpClient`登録をスコープに変更します。</span><span class="sxs-lookup"><span data-stu-id="a8a40-145">Change the `HttpClient` registration to scoped.</span></span>

    ```diff
    -builder.RootComponents.Add<App>("app");
    +builder.RootComponents.Add<App>("#app");
    
    -builder.Services.AddTransient(sp => new HttpClient 
    -    { BaseAddress = new Uri(builder.HostEnvironment.BaseAddress) });
    +builder.Services.AddScoped(sp => new HttpClient 
    +    { BaseAddress = new Uri(builder.HostEnvironment.BaseAddress) });
    ```

### <a name="standalone-no-locblazor-webassembly-app-with-microsoft-accounts"></a><span data-ttu-id="a8a40-146">Blazor WebAssemblyMicrosoft アカウントを使用したスタンドアロンアプリ</span><span class="sxs-lookup"><span data-stu-id="a8a40-146">Standalone Blazor WebAssembly app with Microsoft Accounts</span></span>

<span data-ttu-id="a8a40-147">Blazor WebAssemblyAzure portal に登録されているスタンドアロンアプリの場合、Azure Active Directory (AAD) を Microsoft アカウントに使用します。</span><span class="sxs-lookup"><span data-stu-id="a8a40-147">For a standalone Blazor WebAssembly app registered in the Azure portal to use Azure Active Directory (AAD) for Microsoft Accounts:</span></span>

* <span data-ttu-id="a8a40-148">アプリには、 `openid` スコープとスコープが必要です `offline_access` 。</span><span class="sxs-lookup"><span data-stu-id="a8a40-148">The app requires the `openid` and `offline_access` scopes:</span></span>

  ```csharp
  options.ProviderOptions.DefaultAccessTokenScopes.Add("openid");
  options.ProviderOptions.DefaultAccessTokenScopes.Add("offline_access");
  ```
  
* <span data-ttu-id="a8a40-149">[Azure portal アプリの登録 **認証** ] ブレードで、アプリのリダイレクト URI を使用して、プラットフォームの構成を **シングルページアプリケーション** に設定します。</span><span class="sxs-lookup"><span data-stu-id="a8a40-149">In the Azure portal app registration **Authentication** blade, set the platform configuration to **Single-page application** with the app's redirect URI.</span></span>

* <span data-ttu-id="a8a40-150">また、[**認証**] ブレードで、**アクセストークン** と **ID トークン** の **暗黙的な許可** を無効にします。</span><span class="sxs-lookup"><span data-stu-id="a8a40-150">Also in the **Authentication** blade, disable **Implicit grant** for **Access tokens** and **ID tokens**.</span></span>

<span data-ttu-id="a8a40-151">詳細については、「<xref:blazor/security/webassembly/standalone-with-microsoft-accounts>」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="a8a40-151">For more information, see <xref:blazor/security/webassembly/standalone-with-microsoft-accounts>.</span></span>

### <a name="standalone-no-locblazor-webassembly-app-with-azure-active-directory-aad"></a><span data-ttu-id="a8a40-152">Blazor WebAssemblyAzure Active Directory を使用したスタンドアロンアプリ (AAD)</span><span class="sxs-lookup"><span data-stu-id="a8a40-152">Standalone Blazor WebAssembly app with Azure Active Directory (AAD)</span></span>

<span data-ttu-id="a8a40-153">Blazor WebAssemblyAzure Active Directory (AAD) を使用するために Azure portal に登録されているスタンドアロンアプリの場合:</span><span class="sxs-lookup"><span data-stu-id="a8a40-153">For a standalone Blazor WebAssembly app registered in the Azure portal to use Azure Active Directory (AAD):</span></span>

* <span data-ttu-id="a8a40-154">アプリにはスコープが必要です `https://graph.microsoft.com/User.Read` 。</span><span class="sxs-lookup"><span data-stu-id="a8a40-154">The app requires the `https://graph.microsoft.com/User.Read` scope:</span></span>

  ```csharp
  options.ProviderOptions.DefaultAccessTokenScopes
      .Add("https://graph.microsoft.com/User.Read");
  ```
  
* <span data-ttu-id="a8a40-155">[Azure portal アプリの登録 **認証** ] ブレードで、アプリのリダイレクト URI を使用して、プラットフォームの構成を **シングルページアプリケーション** に設定します。</span><span class="sxs-lookup"><span data-stu-id="a8a40-155">In the Azure portal app registration **Authentication** blade, set the platform configuration to **Single-page application** with the app's redirect URI.</span></span>

* <span data-ttu-id="a8a40-156">また、[**認証**] ブレードで、**アクセストークン** と **ID トークン** の **暗黙的な許可** を無効にします。</span><span class="sxs-lookup"><span data-stu-id="a8a40-156">Also in the **Authentication** blade, disable **Implicit grant** for **Access tokens** and **ID tokens**.</span></span>
  
<span data-ttu-id="a8a40-157">詳細については、「<xref:blazor/security/webassembly/standalone-with-azure-active-directory>」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="a8a40-157">For more information, see <xref:blazor/security/webassembly/standalone-with-azure-active-directory>.</span></span>

### <a name="standalone-no-locblazor-app-with-azure-active-directory-aad-b2c"></a><span data-ttu-id="a8a40-158">BlazorAzure Active Directory (AAD) B2C を使用したスタンドアロンアプリ</span><span class="sxs-lookup"><span data-stu-id="a8a40-158">Standalone Blazor app with Azure Active Directory (AAD) B2C</span></span>

<span data-ttu-id="a8a40-159">Blazor WebAssemblyAzure portal に登録されているスタンドアロンアプリで Azure Active Directory (AAD) B2C を使用するには、次のようにします。</span><span class="sxs-lookup"><span data-stu-id="a8a40-159">For a standalone Blazor WebAssembly app registered in the Azure portal to use Azure Active Directory (AAD) B2C:</span></span>

* <span data-ttu-id="a8a40-160">アプリには、 `openid` スコープとスコープが必要です `offline_access` 。</span><span class="sxs-lookup"><span data-stu-id="a8a40-160">The app requires the `openid` and `offline_access` scopes:</span></span>

  ```csharp
  options.ProviderOptions.DefaultAccessTokenScopes.Add("openid");
  options.ProviderOptions.DefaultAccessTokenScopes.Add("offline_access");
  ```
  
* <span data-ttu-id="a8a40-161">[Azure portal アプリの登録 **認証** ] ブレードで、アプリのリダイレクト URI を使用して、プラットフォームの構成を **シングルページアプリケーション** に設定します。</span><span class="sxs-lookup"><span data-stu-id="a8a40-161">In the Azure portal app registration **Authentication** blade, set the platform configuration to **Single-page application** with the app's redirect URI.</span></span>

* <span data-ttu-id="a8a40-162">また、[**認証**] ブレードで、**アクセストークン** と **ID トークン** の **暗黙的な許可** を無効にします。</span><span class="sxs-lookup"><span data-stu-id="a8a40-162">Also in the **Authentication** blade, disable **Implicit grant** for **Access tokens** and **ID tokens**.</span></span>

<span data-ttu-id="a8a40-163">詳細については、「<xref:blazor/security/webassembly/standalone-with-azure-active-directory-b2c>」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="a8a40-163">For more information, see <xref:blazor/security/webassembly/standalone-with-azure-active-directory-b2c>.</span></span>

### <a name="hosted-no-locblazor-webassembly-app-with-azure-active-directory-aad-or-b2c"></a><span data-ttu-id="a8a40-164">Blazor WebAssemblyAzure Active Directory (AAD) または B2C を使用したホスト型アプリ</span><span class="sxs-lookup"><span data-stu-id="a8a40-164">Hosted Blazor WebAssembly app with Azure Active Directory (AAD) or B2C</span></span>

<span data-ttu-id="a8a40-165">*`Client`* Blazor ユーザー認証に AAD または AAD B2C を使用するホスト型ソリューションのアプリ登録では、**シングルページアプリケーション** の Azure Apps プラットフォーム構成を使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="a8a40-165">The *`Client`* app registration of a hosted Blazor solution that uses AAD or AAD B2C for user authentication should use a **Single-page application** Azure Apps platform configuration:</span></span>

1. <span data-ttu-id="a8a40-166">アプリの Azure portal アプリの登録で、 *`Client`* **Web** platform の構成を削除します。</span><span class="sxs-lookup"><span data-stu-id="a8a40-166">In the Azure portal app registration for the *`Client`* app, remove the **Web** platform configuration.</span></span>
1. <span data-ttu-id="a8a40-167">アプリのリダイレクト URI を使用して、 **シングルページアプリケーション** プラットフォーム構成を追加します。</span><span class="sxs-lookup"><span data-stu-id="a8a40-167">Add a **Single-page application** platform configuration with the app's redirect URI.</span></span>
1. <span data-ttu-id="a8a40-168">**アクセストークン** と **ID トークン** の **暗黙的な許可** を無効にします。</span><span class="sxs-lookup"><span data-stu-id="a8a40-168">Disable **Implicit grant** for **Access tokens** and **ID tokens**.</span></span>

<span data-ttu-id="a8a40-169">詳細については、次を参照してください。</span><span class="sxs-lookup"><span data-stu-id="a8a40-169">For more information, see:</span></span>

* <xref:blazor/security/webassembly/hosted-with-azure-active-directory>
* <xref:blazor/security/webassembly/hosted-with-azure-active-directory-b2c>

### <a name="update-the-server-project-of-a-hosted-no-locblazor-solution"></a><span data-ttu-id="a8a40-170">ホストされているソリューションのサーバープロジェクトを更新する Blazor</span><span class="sxs-lookup"><span data-stu-id="a8a40-170">Update the Server project of a hosted Blazor solution</span></span>

<span data-ttu-id="a8a40-171">*`Server`* Blazor この記事の一般的なガイダンスに従って、ホストされているソリューションのプロジェクトを ASP.NET Core アプリとして更新します。</span><span class="sxs-lookup"><span data-stu-id="a8a40-171">Update the *`Server`* project of a hosted Blazor solution as an ASP.NET Core app following the general guidance in this article.</span></span>

<span data-ttu-id="a8a40-172">さらに、 *`Server`* Azure Active Directory (AAD) または B2C を使用してクライアントアプリに対してユーザーを認証するプロジェクトでは、 Blazor WebAssembly 新しい Microsoft v2.0 パッケージを採用する必要があり Identity ます。</span><span class="sxs-lookup"><span data-stu-id="a8a40-172">Additionally, *`Server`* projects that authenticate users to client Blazor WebAssembly apps with Azure Active Directory (AAD) or B2C should adopt new Microsoft Identity v2.0 packages:</span></span> 
  
<span data-ttu-id="a8a40-173">AAD の場合:</span><span class="sxs-lookup"><span data-stu-id="a8a40-173">For AAD:</span></span>

```diff
-<PackageReference Include="Microsoft.AspNetCore.Authentication.AzureAD.UI" Version="..." />
+<PackageReference Include="Microsoft.Identity.Web" Version="1.2.0" />
+<PackageReference Include="Microsoft.Identity.Web.UI" Version="1.2.0" />
```

<span data-ttu-id="a8a40-174">AAD B2C の場合:</span><span class="sxs-lookup"><span data-stu-id="a8a40-174">For AAD B2C:</span></span>

```diff
-<PackageReference Include="Microsoft.AspNetCore.Authentication.AzureADB2C.UI" Version="..." />
+<PackageReference Include="Microsoft.Identity.Web" Version="1.2.0" />
+<PackageReference Include="Microsoft.Identity.Web.UI" Version="1.2.0" />
```

> [!NOTE]
> <span data-ttu-id="a8a40-175">ホストされているソリューション内のプロジェクトの SDK は、 *`Server`* Blazor WebAssembly 次のように `Microsoft.NET.Sdk.Web` なります。</span><span class="sxs-lookup"><span data-stu-id="a8a40-175">The SDK of the *`Server`* project in a hosted Blazor WebAssembly solution remains `Microsoft.NET.Sdk.Web`:</span></span>
>
> ```xml
> <Project Sdk="Microsoft.NET.Sdk.Web">
> ```

<span data-ttu-id="a8a40-176">詳細については、次を参照してください。</span><span class="sxs-lookup"><span data-stu-id="a8a40-176">For more information, see:</span></span>

* <xref:blazor/security/webassembly/hosted-with-azure-active-directory>
* <xref:blazor/security/webassembly/hosted-with-azure-active-directory-b2c>

### <a name="unauthorized-client-for-azure-active-directory-aad"></a><span data-ttu-id="a8a40-177">Azure Active Directory の承認されていないクライアント (AAD)</span><span class="sxs-lookup"><span data-stu-id="a8a40-177">Unauthorized client for Azure Active Directory (AAD)</span></span>

<span data-ttu-id="a8a40-178">Blazor WebAssemblyAad を使用するアプリを認証にアップグレードした後、ユーザーが aad でサインインした後、ログインコールバックでアプリに対して次のエラーが表示されることがあります。</span><span class="sxs-lookup"><span data-stu-id="a8a40-178">After upgrading a Blazor WebAssembly app that uses AAD for authentication, you may receive the following error on the login callback to the app after the user signs in with AAD:</span></span>

> <span data-ttu-id="a8a40-179">情報: AspNetCore [2] 承認に失敗しました。</span><span class="sxs-lookup"><span data-stu-id="a8a40-179">info: Microsoft.AspNetCore.Authorization.DefaultAuthorizationService[2] Authorization failed.</span></span> <span data-ttu-id="a8a40-180">これらの要件が満たされていません: DenyAnonymousAuthorizationRequirement: 認証されたユーザーが必要です。</span><span class="sxs-lookup"><span data-stu-id="a8a40-180">These requirements were not met: DenyAnonymousAuthorizationRequirement: Requires an authenticated user.</span></span>

<span data-ttu-id="a8a40-181">AAD からのログインコールバックエラー:</span><span class="sxs-lookup"><span data-stu-id="a8a40-181">Login callback error from AAD:</span></span>

* <span data-ttu-id="a8a40-182">エラー: `unauthorized_client`</span><span class="sxs-lookup"><span data-stu-id="a8a40-182">Error: `unauthorized_client`</span></span>
* <span data-ttu-id="a8a40-183">説明: `AADB2C90058: The provided application is not configured to allow public clients.`</span><span class="sxs-lookup"><span data-stu-id="a8a40-183">Description: `AADB2C90058: The provided application is not configured to allow public clients.`</span></span>

<span data-ttu-id="a8a40-184">このエラーを解決するには:</span><span class="sxs-lookup"><span data-stu-id="a8a40-184">To resolve the error:</span></span>

1. <span data-ttu-id="a8a40-185">Azure portal で、 [アプリのマニフェスト](/azure/active-directory/develop/reference-app-manifest)にアクセスします。</span><span class="sxs-lookup"><span data-stu-id="a8a40-185">In the Azure portal, access the [app's manifest](/azure/active-directory/develop/reference-app-manifest).</span></span>
1. <span data-ttu-id="a8a40-186">属性を [`allowPublicClient`](/azure/active-directory/develop/reference-app-manifest#allowpublicclient-attribute) またはに設定し `null` `true` ます。</span><span class="sxs-lookup"><span data-stu-id="a8a40-186">Set the [`allowPublicClient`](/azure/active-directory/develop/reference-app-manifest#allowpublicclient-attribute) attribute to `null` or `true`.</span></span>

## <a name="update-no-locrazor-class-libraries-rcls"></a><span data-ttu-id="a8a40-187">Razorクラスライブラリの更新 (RCLs)</span><span class="sxs-lookup"><span data-stu-id="a8a40-187">Update Razor class libraries (RCLs)</span></span>

<span data-ttu-id="a8a40-188">RazorASP.NET Core 5.0 の一部として導入された新しい api または機能を利用するには、クラスライブラリ (RCLs) を移行します。</span><span class="sxs-lookup"><span data-stu-id="a8a40-188">Migrate Razor class libraries (RCLs) to take advantage of new APIs or features that are introduced as part of ASP.NET Core 5.0.</span></span> 

<span data-ttu-id="a8a40-189">コンポーネントを対象とする RCL を更新するには、次のようにします。</span><span class="sxs-lookup"><span data-stu-id="a8a40-189">To update a RCL that targets components:</span></span>

1. <span data-ttu-id="a8a40-190">プロジェクトファイルの次のプロパティを更新します。</span><span class="sxs-lookup"><span data-stu-id="a8a40-190">Update the following properties in the project file:</span></span>

   ```diff
   <Project Sdk="Microsoft.NET.Sdk.Razor">
    
     <PropertyGroup>
   -     <TargetFramework>netstandard2.0</TargetFramework>
   -     <RazorLangVersion>3.0</RazorLangVersion>
   +     <TargetFramework>net5.0</TargetFramework>
     </PropertyGroup>
   ```

1. <span data-ttu-id="a8a40-191">他のパッケージを最新バージョンに更新します。</span><span class="sxs-lookup"><span data-stu-id="a8a40-191">Update other packages to their latest versions.</span></span> <span data-ttu-id="a8a40-192">最新バージョンについては、 [NuGet.org](https://www.nuget.org)を参照してください。</span><span class="sxs-lookup"><span data-stu-id="a8a40-192">The latest versions can be found at [NuGet.org](https://www.nuget.org).</span></span>

<span data-ttu-id="a8a40-193">RCL をターゲットとする MVC を更新するには、プロジェクトファイルの次のプロパティを更新します。</span><span class="sxs-lookup"><span data-stu-id="a8a40-193">To update an RCL targeting MVC, update the following properties in the project file:</span></span>

```diff
<Project Sdk="Microsoft.NET.Sdk.Razor">

  <PropertyGroup>
-    <TargetFramework>netcoreapp3.1</TargetFramework>
+    <TargetFramework>net5.0</TargetFramework>
    <AddRazorSupportForMvc>true</AddRazorSupportForMvc>
  </PropertyGroup>
```

## <a name="update-package-references"></a><span data-ttu-id="a8a40-194">パッケージ参照の更新</span><span class="sxs-lookup"><span data-stu-id="a8a40-194">Update package references</span></span>

<span data-ttu-id="a8a40-195">プロジェクトファイルで、 [AspNetCore.](https://www.nuget.org/packages?q=Microsoft.AspNetCore.*)*、Microsoft. [entityframeworkcore. \*](https://www.nuget.org/packages?q=Microsoft.EntityFrameworkCore.*)、 [microsoft. Extensions.](https://www.nuget.org/packages?q=Microsoft.Extensions.*)* を更新し、パッケージ参照の属性 [ を](https://www.nuget.org/packages/System.Net.Http.Json) `Version` 5.0.0 以降にSystem.Net.Http.Jsします。</span><span class="sxs-lookup"><span data-stu-id="a8a40-195">In the project file, update each [Microsoft.AspNetCore.\*](https://www.nuget.org/packages?q=Microsoft.AspNetCore.*), [Microsoft.EntityFrameworkCore.\*](https://www.nuget.org/packages?q=Microsoft.EntityFrameworkCore.*), [Microsoft.Extensions.\*](https://www.nuget.org/packages?q=Microsoft.Extensions.*), and [System.Net.Http.Json](https://www.nuget.org/packages/System.Net.Http.Json) package reference's `Version` attribute to 5.0.0 or later.</span></span> <span data-ttu-id="a8a40-196">次に例を示します。</span><span class="sxs-lookup"><span data-stu-id="a8a40-196">For example:</span></span>

```diff
<ItemGroup>
-    <PackageReference Include="Microsoft.AspNetCore.JsonPatch" Version="3.1.6" />
-    <PackageReference Include="Microsoft.EntityFrameworkCore.Tools" Version="3.1.6">
-    <PackageReference Include="Microsoft.Extensions.Caching.Abstractions" Version="3.1.6" />
-    <PackageReference Include="System.Net.Http.Json" Version="3.2.1" />
+    <PackageReference Include="Microsoft.AspNetCore.JsonPatch" Version="5.0.0" />
+    <PackageReference Include="Microsoft.EntityFrameworkCore.Tools" Version="5.0.0">
+    <PackageReference Include="Microsoft.Extensions.Caching.Abstractions" Version="5.0.0" />
+    <PackageReference Include="System.Net.Http.Json" Version="5.0.0" />
</ItemGroup>
```

## <a name="update-docker-images"></a><span data-ttu-id="a8a40-197">Docker イメージの更新</span><span class="sxs-lookup"><span data-stu-id="a8a40-197">Update Docker images</span></span>

<span data-ttu-id="a8a40-198">Docker を使用するアプリでは、 *Dockerfile* `FROM` ステートメントとスクリプトを更新します。</span><span class="sxs-lookup"><span data-stu-id="a8a40-198">For apps using Docker, update your *Dockerfile* `FROM` statements and scripts.</span></span> <span data-ttu-id="a8a40-199">ASP.NET Core 5.0 ランタイムを含む基本イメージを使用します。</span><span class="sxs-lookup"><span data-stu-id="a8a40-199">Use a base image that includes the ASP.NET Core 5.0 runtime.</span></span> <span data-ttu-id="a8a40-200">`docker pull`ASP.NET Core 3.1 と5.0 の間で、次のコマンドの違いを考慮してください。</span><span class="sxs-lookup"><span data-stu-id="a8a40-200">Consider the following `docker pull` command difference between ASP.NET Core 3.1 and 5.0:</span></span>

```diff
- docker pull mcr.microsoft.com/dotnet/core/aspnet:3.1
+ docker pull mcr.microsoft.com/dotnet/aspnet:5.0
```

<span data-ttu-id="a8a40-201">製品名として ".NET" への移行の一環として、Docker イメージはリポジトリからに移動されました `mcr.microsoft.com/dotnet/core` `mcr.microsoft.com/dotnet` 。</span><span class="sxs-lookup"><span data-stu-id="a8a40-201">As part of the move to ".NET" as the product name, the Docker images moved from the `mcr.microsoft.com/dotnet/core` repositories to `mcr.microsoft.com/dotnet`.</span></span> <span data-ttu-id="a8a40-202">詳細については、「 [dotnet/dotnet-docker # 1939](https://github.com/dotnet/dotnet-docker/issues/1939)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="a8a40-202">For more information, see [dotnet/dotnet-docker#1939](https://github.com/dotnet/dotnet-docker/issues/1939).</span></span>

## <a name="model-binding-changes-in-aspnet-core-mvc-and-no-locrazor-pages"></a><span data-ttu-id="a8a40-203">MVC とページ ASP.NET Core のモデルバインドの変更 Razor</span><span class="sxs-lookup"><span data-stu-id="a8a40-203">Model binding changes in ASP.NET Core MVC and Razor Pages</span></span>

### <a name="datetime-values-are-model-bound-as-utc-times"></a><span data-ttu-id="a8a40-204">DateTime 値は、UTC 時刻としてモデルにバインドされます</span><span class="sxs-lookup"><span data-stu-id="a8a40-204">DateTime values are model bound as UTC times</span></span>

<span data-ttu-id="a8a40-205">3.1 以前のバージョン ASP.NET Core では、値は、 `DateTime` タイムゾーンがサーバーによって決定された、ローカル時刻としてモデルにバインドされていました。</span><span class="sxs-lookup"><span data-stu-id="a8a40-205">In ASP.NET Core 3.1 and earlier, `DateTime` values were model-bound as local time, where the timezone was determined by the server.</span></span> <span data-ttu-id="a8a40-206">`DateTime` 入力形式 (JSON) と値からバインドされた値は、 `DateTimeOffset` UTC タイムゾーンとしてバインドされました。</span><span class="sxs-lookup"><span data-stu-id="a8a40-206">`DateTime` values bound from input formatting (JSON) and `DateTimeOffset` values were bound as UTC timezones.</span></span>

<span data-ttu-id="a8a40-207">ASP.NET Core 5.0 以降では、モデルバインドは常に `DateTime` UTC タイムゾーンを使用して値をバインドします。</span><span class="sxs-lookup"><span data-stu-id="a8a40-207">In ASP.NET Core 5.0 and later, model binding consistently binds `DateTime` values with the UTC timezone.</span></span>

<span data-ttu-id="a8a40-208">以前の動作を保持するには、のを削除し `DateTimeModelBinderProvider` `Startup.ConfigureServices` ます。</span><span class="sxs-lookup"><span data-stu-id="a8a40-208">To retain the previous behavior, remove the `DateTimeModelBinderProvider` in `Startup.ConfigureServices`:</span></span>

```csharp
services.AddControllersWithViews(options => 
    options.ModelBinderProviders.RemoveType<DateTimeModelBinderProvider>());
```

### <a name="complexobjectmodelbinderprovider--complexobjectmodelbinder-replace-complextypemodelbinderprovider--complextypemodelbinder"></a><span data-ttu-id="a8a40-209">ComplexObjectModelBinderProvider \ ComplexObjectModelBinder replace ComplexTypeModelBinderProvider \ ComplexTypeModelBinder</span><span class="sxs-lookup"><span data-stu-id="a8a40-209">ComplexObjectModelBinderProvider \ ComplexObjectModelBinder replace ComplexTypeModelBinderProvider \ ComplexTypeModelBinder</span></span>

<span data-ttu-id="a8a40-210">モデルバインド [C# 9 レコードの種類](/dotnet/csharp/whats-new/csharp-9#record-types)のサポートを追加するには、次のようにし <xref:Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexTypeModelBinderProvider> ます。</span><span class="sxs-lookup"><span data-stu-id="a8a40-210">To add support for model binding [C# 9 record types](/dotnet/csharp/whats-new/csharp-9#record-types), the <xref:Microsoft.AspNetCore.Mvc.ModelBinding.Binders.ComplexTypeModelBinderProvider> is:</span></span>

* <span data-ttu-id="a8a40-211">不使用として注釈が付けられます。</span><span class="sxs-lookup"><span data-stu-id="a8a40-211">Annotated as obsolete.</span></span>
* <span data-ttu-id="a8a40-212">既定では登録されなくなりました。</span><span class="sxs-lookup"><span data-stu-id="a8a40-212">No longer registered by default.</span></span>

<span data-ttu-id="a8a40-213">コレクション内のの存在に依存するアプリは、 `ComplexTypeModelBinderProvider` `ModelBinderProviders` 新しいバインダープロバイダーを参照する必要があります。</span><span class="sxs-lookup"><span data-stu-id="a8a40-213">Apps that rely on the presence of the `ComplexTypeModelBinderProvider` in the `ModelBinderProviders` collection need to reference the new binder provider:</span></span>

```diff
- var complexModelBinderProvider = options.ModelBinderProviders.OfType<ComplexTypeModelBinderProvider>();
+ var complexModelBinderProvider = options.ModelBinderProviders.OfType<ComplexObjectModelBinderProvider>();
```

## <a name="review-breaking-changes"></a><span data-ttu-id="a8a40-214">重大な変更の確認</span><span class="sxs-lookup"><span data-stu-id="a8a40-214">Review breaking changes</span></span>

<span data-ttu-id="a8a40-215">.NET Core 3.1 から .NET 5.0 への重大な変更については、「 [バージョン3.1 から5.0 への移行に関する重大な変更](/dotnet/core/compatibility/3.1-5.0)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="a8a40-215">For breaking changes from .NET Core 3.1 to .NET 5.0, see [Breaking changes for migration from version 3.1 to 5.0](/dotnet/core/compatibility/3.1-5.0).</span></span> <span data-ttu-id="a8a40-216">ASP.NET Core と Entity Framework Core も一覧に含まれています。</span><span class="sxs-lookup"><span data-stu-id="a8a40-216">ASP.NET Core and Entity Framework Core are also included in the list.</span></span>
